# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –£–¥–∞–ª–µ–Ω–∏–µ –ó–∞–ø–∏—Å–µ–π

## –ü—Ä–æ–±–ª–µ–º–∞
Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–ª `DELETE /api/recordings/{id}/`, –Ω–æ backend –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª DELETE –º–µ—Ç–æ–¥ –Ω–∞ —ç—Ç–æ–º endpoint.

## –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ DELETE –º–µ—Ç–æ–¥–∞ –≤ `recording_detail` view:
- `GET /api/recordings/{id}/` - –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏
- `DELETE /api/recordings/{id}/` - —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª**: `teaching_panel/schedule/views.py`

### –î–æ:
```python
@api_view(['GET'])
@permission_classes([IsAuthenticated])
def recording_detail(request, recording_id):
    # –¢–æ–ª—å–∫–æ GET
```

### –ü–æ—Å–ª–µ:
```python
@api_view(['GET', 'DELETE'])
@permission_classes([IsAuthenticated])
def recording_detail(request, recording_id):
    if request.method == 'DELETE':
        # –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:
        # - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (—Ç–æ–ª—å–∫–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å-–≤–ª–∞–¥–µ–ª–µ—Ü)
        # - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
        # - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ Google Drive
        # - –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–≤–æ—Ç—ã
        # - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –£–¥–∞–ª–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤**:
   - –¢–æ–ª—å–∫–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏
   - –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∑–∞–ø–∏—Å–∏ –º–æ–∂–µ—Ç –µ—ë —É–¥–∞–ª–∏—Ç—å
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞

2. **–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞**:
   - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Google Drive (`gdrive_file_id`)
   - –§–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Google Drive API
   - –î–∞–∂–µ –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∑–∞–ø–∏—Å—å —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ë–î

3. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–≤–æ—Ç—ã**:
   - –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ `used_storage_gb` –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
   - –ö–≤–æ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

4. **–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î**:
   - –ó–∞–ø–∏—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (allowed_groups, allowed_students) —É–¥–∞–ª—è—é—Ç—Å—è CASCADE

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
–°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
python3 test_recording_delete.py
# –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å ID=1
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –í–æ–π—Ç–∏: `test_teacher_recording@example.com` / `test123456`
2. –ü–µ—Ä–µ–π—Ç–∏: –†–∞–∑–¥–µ–ª "–ó–∞–ø–∏—Å–∏"
3. –ù–∞–π—Ç–∏: –ó–∞–ø–∏—Å—å ID=1
4. –ù–∞–∂–∞—Ç—å: –ö–Ω–æ–ø–∫—É "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å"
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- ‚úÖ –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: –∑–∞–ø–∏—Å—å –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞"
- ‚ùå –û—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ—Ç

## Deployment

**–ö–æ–º–º–∏—Ç**: `fc21732`
```
Fix recording deletion: add DELETE method support to recording_detail endpoint
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –Ω–∞ production (http://72.56.81.163)

## API Endpoint

```http
DELETE /api/schedule/recordings/{id}/
Authorization: Bearer <access_token>
```

**Response 200 OK**:
```json
{
  "message": "–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞",
  "recording_id": "1"
}
```

**Response 403 Forbidden**:
```json
{
  "error": "–¢–æ–ª—å–∫–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏"
}
// –∏–ª–∏
{
  "error": "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏"
}
// –∏–ª–∏
{
  "detail": "–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞"
}
```

**Response 404 Not Found**:
```json
{
  "error": "–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
}
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏:
```
[INFO] Deleted file {gdrive_file_id} from Google Drive
[INFO] Freed {file_size} bytes for teacher {teacher_id}
[INFO] Teacher {teacher_id} deleted recording {recording_id} ({lesson_title})
```

---

**–î–∞—Ç–∞**: 4 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
