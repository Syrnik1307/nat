# 🎯 Пример AI-проверки сочинения ЕГЭ (Русский язык, Задание 27)

## Исходные данные

### Текст задания

```
Прочитайте текст и напишите по нему сочинение.

Сформулируйте одну из проблем, поставленных автором текста.
Прокомментируйте сформулированную проблему. Включите в комментарий 
два примера-иллюстрации из прочитанного текста, которые важны для 
понимания проблемы исходного текста (избегайте чрезмерного цитирования). 
Дайте пояснение к каждому примеру-иллюстрации. Укажите смысловую связь 
между примерами-иллюстрациями и проанализируйте её.

Сформулируйте позицию автора (рассказчика).
Сформулируйте и обоснуйте своё отношение к позиции автора (рассказчика) 
по проблеме исходного текста.

Объём сочинения – не менее 150 слов.
```

**Исходный текст** (фрагмент):
```
(1) Когда мне было лет десять, я прочитал "Войну и мир". (2) Прочитал 
не потому, что заставили в школе, а по собственному желанию... 
(3) Книга перевернула моё представление о мире... [далее 20 предложений]
```

### Ответ студента (Петрова Анна)

```
В предложенном для анализа тексте автор поднимает проблему роли 
чтения в формировании личности человека.

Раскрывая данную проблему, автор приводит в пример историю о 
мальчике, который впервые прочитал "Войну и мир" в десятилетнем 
возрасте (предложения 1-2). Это показывает, что книга может оказать 
влияние на человека уже в детстве. Автор также отмечает, что герой 
перечитывал это произведение множество раз на протяжении жизни 
(предложение 15), что демонстрирует долгосрочное воздействие 
литературы. Оба примера дополняют друг друга, иллюстрируя разные 
этапы взаимодействия с книгой.

Позиция автора очевидна: чтение классической литературы формирует 
мировоззрение человека, его ценности и взгляды на жизнь.

Я полностью согласна с автором. Действительно, книги играют огромную 
роль в становлении человека как личности. Например, читая произведения 
Достоевского можно научиться глубже понимать психологию людей, их 
внутренние мотивы и переживания.

Таким образом чтение - это не просто хобби, а важнейший инструмент 
развития и саморазвития личности.
```

---

## 🤖 Промпт для AI (что отправляется в DeepSeek)

### System Prompt

```
Ты - эксперт по проверке экзаменационных работ ЕГЭ.

ТВОЯ ЗАДАЧА: Оценить развернутый ответ ученика строго по критериям ФИПИ.

КРИТИЧЕСКИ ВАЖНО:
1. Применяй ТОЛЬКО указанные критерии (K1, K2, K3...)
2. Для каждого критерия выставляй балл согласно требованиям
3. Объясняй почему поставлен именно такой балл
4. Если ответ на грани между баллами - выбирай СТРОГО по описанию уровня
5. Не придумывай свои критерии - используй только переданные

ФОРМАТ ОТВЕТА (СТРОГО JSON):
{
    "criteria_scores": {
        "K1": {
            "score": <число>,
            "max": <число>,
            "justification": "Почему такой балл..."
        },
        "K2": {...},
        ...
    },
    "total_score": <сумма>,
    "total_max": <сумма максимумов>,
    "feedback": "Общий комментарий для ученика",
    "confidence": <0.0-1.0>,
    "warnings": ["Если что-то непонятно в ответе"]
}

НЕ отходи от формата. НЕ добавляй рассуждения вне JSON.
```

### User Prompt

```
=== ЗАДАНИЕ ===
Номер: Задание 27 (ЕГЭ Русский язык)
Текст: Напишите сочинение по прочитанному тексту. Сформулируйте проблему...

=== КРИТЕРИИ ОЦЕНИВАНИЯ (ФИПИ 2025) ===

K1. Формулировка проблем исходного текста (макс. 1 балл)
Описание: Экзаменуемый верно сформулировал одну из проблем исходного текста
Уровни:
  1 балл: Проблема сформулирована верно, фактических ошибок нет
  0 баллов: Проблема не сформулирована или сформулирована неверно

K2. Комментарий к сформулированной проблеме (макс. 6 баллов)
Описание: Сформулированная проблема прокомментирована с опорой на текст...
Уровни:
  6 баллов: Приведено 2 примера-иллюстрации. Дано пояснение к каждому. 
           Указана и проанализирована смысловая связь. Фактических ошибок нет.
  5 баллов: Приведено 2 примера-иллюстрации. Дано пояснение к каждому. 
           Смысловая связь указана, но не проанализирована (или проанализирована неверно).
  4 балла: Приведено 2 примера-иллюстрации. Дано пояснение к одному из примеров. 
           Смысловая связь указана, но не проанализирована.
  3 балла: Приведено 2 примера-иллюстрации. Пояснение к одному примеру. 
           Смысловая связь не указана.
  2 балла: Приведены 1-2 примера. Пояснения не даны.
  1 балл: Приведен 1 пример. Дано пояснение.
  0 баллов: Примеры не приведены или не из текста.

K3. Отражение позиции автора исходного текста (макс. 1 балл)
Описание: Позиция автора по проблеме сформулирована верно
Уровни:
  1 балл: Позиция автора сформулирована верно
  0 баллов: Не сформулирована или сформулирована неверно

K4. Отношение к позиции автора (макс. 1 балл)
Описание: Выражено отношение к позиции автора и обосновано
Уровни:
  1 балл: Отношение сформулировано и обосновано
  0 баллов: Не сформулировано и не обосновано

K5. Смысловая цельность, речевая связность (макс. 2 балла)
Описание: Работа характеризуется смысловой цельностью, связностью
Уровни:
  2 балла: Логических ошибок нет или не более 1
  1 балл: Допущено 2 логические ошибки
  0 баллов: Нарушена цельность или 3+ логических ошибки

K6. Точность и выразительность речи (макс. 2 балла)
Описание: Точность выражения мысли, разнообразие грамматического строя
Уровни:
  2 балла: Точность + разнообразие грамматических форм
  1 балл: Точность, но однообразие грамматики
  0 баллов: Бедность словаря и однообразие грамматики

K7. Соблюдение орфографических норм (макс. 3 балла)
Уровни:
  3 балла: Ошибок нет (или 1 негрубая)
  2 балла: 1-2 орфографические ошибки
  1 балл: 3-4 орфографические ошибки
  0 баллов: 5+ орфографических ошибок

K8. Соблюдение пунктуационных норм (макс. 3 балла)
Уровни:
  3 балла: Ошибок нет (или 1 негрубая)
  2 балла: 1-3 пунктуационные ошибки
  1 балл: 4-5 пунктуационных ошибок
  0 баллов: 6+ пунктуационных ошибок

K9. Соблюдение языковых норм (макс. 2 балла)
Уровни:
  2 балла: Грамматических ошибок нет
  1 балл: 1-2 грамматические ошибки
  0 баллов: 3+ грамматических ошибок

K10. Соблюдение речевых норм (макс. 2 балла)
Уровни:
  2 балла: Не более 1 речевой ошибки
  1 балл: 2-3 речевые ошибки
  0 баллов: 4+ речевых ошибок

K11. Соблюдение этических норм (макс. 1 балл)
Уровни:
  1 балл: Этических ошибок нет
  0 баллов: Допущены этические ошибки

K12. Соблюдение фактологической точности (макс. 1 балл)
Уровни:
  1 балл: Фактических ошибок в фоновом материале нет
  0 баллов: Допущены фактические ошибки

=== ПРИМЕРЫ ОЦЕНИВАНИЯ (для калибровки) ===

Пример 1:
Ответ: "В данном тексте автор поднимает проблему... [похожий ответ]"
Оценка: {"K1": 1, "K2": 5, "K3": 1, "K4": 1, "K5": 2, "K6": 2, "K7": 3, "K8": 2, "K9": 2, "K10": 2, "K11": 1, "K12": 1, "total": 23}
Объяснение: K2 = 5 баллов т.к. смысловая связь указана ("дополняют друг друга"), 
но не проанализирована глубоко. K8 = 2 балла: 2 пунктуационные ошибки (запятые).

=== ОТВЕТ УЧЕНИКА (проверяемый) ===
В предложенном для анализа тексте автор поднимает проблему роли 
чтения в формировании личности человека.

Раскрывая данную проблему, автор приводит в пример историю о 
мальчике, который впервые прочитал "Войну и мир" в десятилетнем 
возрасте (предложения 1-2). Это показывает, что книга может оказать 
влияние на человека уже в детстве. Автор также отмечает, что герой 
перечитывал это произведение множество раз на протяжении жизни 
(предложение 15), что демонстрирует долгосрочное воздействие 
литературы. Оба примера дополняют друг друга, иллюстрируя разные 
этапы взаимодействия с книгой.

Позиция автора очевидна: чтение классической литературы формирует 
мировоззрение человека, его ценности и взгляды на жизнь.

Я полностью согласна с автором. Действительно, книги играют огромную 
роль в становлении человека как личности. Например, читая произведения 
Достоевского можно научиться глубже понимать психологию людей, их 
внутренние мотивы и переживания.

Таким образом чтение - это не просто хобби, а важнейший инструмент 
развития и саморазвития личности.

=== ИНСТРУКЦИЯ ===
Оцени ответ строго по указанным критериям. Заполни JSON со score для каждого критерия.
```

---

## 📥 Ответ AI (DeepSeek V3)

```json
{
  "criteria_scores": {
    "K1": {
      "score": 1,
      "max": 1,
      "justification": "Проблема роли чтения в формировании личности сформулирована верно и соответствует содержанию текста. Фактических ошибок нет."
    },
    "K2": {
      "score": 5,
      "max": 6,
      "justification": "Приведено 2 примера-иллюстрации из текста (первое чтение в 10 лет, перечитывание на протяжении жизни). К каждому примеру дано пояснение (влияние в детстве, долгосрочное воздействие). Смысловая связь между примерами указана ('дополняют друг друга, иллюстрируя разные этапы'), но анализ связи поверхностный - не раскрыто, КАК именно эти этапы связаны (хронологическая последовательность? усиление эффекта?). Согласно критериям, это соответствует 5 баллам."
    },
    "K3": {
      "score": 1,
      "max": 1,
      "justification": "Позиция автора сформулирована верно: 'чтение классической литературы формирует мировоззрение человека, его ценности и взгляды на жизнь'."
    },
    "K4": {
      "score": 1,
      "max": 1,
      "justification": "Отношение к позиции автора выражено ('Я полностью согласна') и обосновано примером (чтение Достоевского помогает понимать психологию людей)."
    },
    "K5": {
      "score": 2,
      "max": 2,
      "justification": "Работа логично выстроена: вступление (формулировка проблемы) → основная часть (комментарий с примерами) → позиция автора → собственное мнение → заключение. Логических ошибок не обнаружено."
    },
    "K6": {
      "score": 2,
      "max": 2,
      "justification": "Мысли выражены точно, использованы разнообразные грамматические конструкции (сложноподчинённые предложения, причастные обороты, деепричастные обороты). Лексика соответствует задаче."
    },
    "K7": {
      "score": 3,
      "max": 3,
      "justification": "Орфографических ошибок не обнаружено."
    },
    "K8": {
      "score": 2,
      "max": 3,
      "justification": "Обнаружены 2 пунктуационные ошибки: 1) Отсутствие запятой после 'Например' в предпоследнем абзаце ('Например, читая произведения Достоевского' - правильно). 2) Отсутствие запятой перед 'что' в предложении 'Автор также отмечает, что герой...' (ошибки нет, здесь запятая стоит верно). Пересмотр: 1 ошибка - отсутствие запятой после 'Например'. 2) Отсутствие запятой в последнем предложении ('Таким образом, чтение' - должна быть запятая, её нет). Итого: 2 пунктуационные ошибки = 2 балла."
    },
    "K9": {
      "score": 2,
      "max": 2,
      "justification": "Грамматических ошибок не обнаружено. Все формы слов и синтаксические конструкции использованы правильно."
    },
    "K10": {
      "score": 2,
      "max": 2,
      "justification": "Речевых ошибок не обнаружено. Стиль соответствует жанру сочинения-рассуждения."
    },
    "K11": {
      "score": 1,
      "max": 1,
      "justification": "Этических ошибок (неуважительного тона, грубостей) в работе нет."
    },
    "K12": {
      "score": 1,
      "max": 1,
      "justification": "Фактических ошибок в фоновом материале (упоминание Достоевского и его произведений) нет."
    }
  },
  "total_score": 23,
  "total_max": 25,
  "feedback": "Отличная работа! Вы продемонстрировали хорошее понимание текста и умение аргументировать свою позицию. Основные критерии выполнены на высоком уровне.\n\n**Что получилось хорошо:**\n- Чётко сформулирована проблема\n- Приведены уместные примеры из текста с пояснениями\n- Грамотно изложена позиция автора и собственное мнение\n- Практически без орфографических и грамматических ошибок\n\n**Как улучшить (К2 - 5 из 6 баллов):**\nВы указали смысловую связь между примерами ('дополняют друг друга'), но не проанализировали её достаточно глубоко. Для получения 6 баллов нужно объяснить, КАК именно примеры связаны. Например: 'Эти примеры связаны хронологически и показывают развитие взаимодействия с книгой: первый пример демонстрирует начальное впечатление, а второй - устойчивое долгосрочное влияние, что подчёркивает не случайность, а закономерность воздействия чтения на личность.'\n\n**Пунктуация (К8 - 2 из 3 баллов):**\n1. После вводного слова 'Например' нужна запятая: 'Например**,** читая произведения Достоевского...'\n2. После вводного словосочетания 'Таким образом' нужна запятая: 'Таким образом**,** чтение...'\n\nИсправьте эти недочёты - и ваша работа будет на уровне 25 баллов!",
  "confidence": 0.92,
  "warnings": []
}
```

---

## 🎓 Что сохраняется в БД

### Модель Answer (после проверки)

```python
Answer.objects.get(id=1234).__dict__

{
    'id': 1234,
    'submission_id': 567,
    'question_id': 89,
    'text_answer': 'В предложенном для анализа тексте...',  # Полный ответ
    
    # Стандартные поля
    'auto_score': 23,  # От AI
    'teacher_score': None,  # Учитель ещё не изменил
    'teacher_feedback': '',  # Пусто, пока учитель не добавит
    'needs_manual_review': False,  # confidence > 0.75
    
    # Новые поля для ЕГЭ/ОГЭ
    'exam_criteria_scores': {
        'K1': {'score': 1, 'max': 1, 'justification': '...'},
        'K2': {'score': 5, 'max': 6, 'justification': '...'},
        # ... остальные критерии
        'total': 23,
        'total_max': 25
    },
    
    'exam_ai_warnings': [],  # Пустой список, т.к. AI уверен
    
    'was_cached': False,  # Первая проверка такого ответа
    'ai_cost_usd': Decimal('0.00014'),  # Стоимость запроса
    
    'answered_at': datetime(2026, 2, 15, 14, 32, 18)
}
```

---

## 📊 UI отображение для студента

### В списке ответов

```
┌─────────────────────────────────────────────────┐
│ Вопрос 1: Сочинение по тексту                   │
│                                                 │
│ ✅ Ваш ответ:                                   │
│    "В предложенном для анализа тексте..."       │
│                                                 │
│ 🤖 AI-оценка: 23 / 25 (92% уверенность)         │
│                                                 │
│ 📋 Детальная оценка по критериям:               │
│    К1: 1/1 ✓  К2: 5/6 ~  К3: 1/1 ✓             │
│    К4: 1/1 ✓  К5: 2/2 ✓  К6: 2/2 ✓             │
│    К7: 3/3 ✓  К8: 2/3 ~  К9: 2/2 ✓             │
│    К10: 2/2 ✓ К11: 1/1 ✓ К12: 1/1 ✓            │
│                                                 │
│ 💬 Комментарий AI:                              │
│    Отличная работа! Основные критерии выполнены │
│    на высоком уровне. Рекомендации:             │
│    • K2: Углубить анализ связи между примерами  │
│    • K8: Проверить пунктуацию с вводными словами│
│                                                 │
│ [📖 Показать подробный разбор]                  │
└─────────────────────────────────────────────────┘
```

### При клике "Показать подробный разбор"

```
╔══════════════════════════════════════════════════╗
║ Детальная оценка: Сочинение по тексту            ║
╠══════════════════════════════════════════════════╣
║ К1. Формулировка проблемы           1 / 1  ✓    ║
║ ─────────────────────────────────────────────    ║
║ Проблема роли чтения в формировании личности     ║
║ сформулирована верно. Фактических ошибок нет.    ║
╠══════════════════════════════════════════════════╣
║ К2. Комментарий к проблеме          5 / 6  ~    ║
║ ─────────────────────────────────────────────    ║
║ Приведено 2 примера-иллюстрации. К каждому дано  ║
║ пояснение. Смысловая связь указана ('дополняют   ║
║ друг друга'), но анализ поверхностный.           ║
║                                                  ║
║ 💡 Как улучшить:                                 ║
║ Объясните КАК именно примеры связаны. Например:  ║
║ "Эти примеры связаны хронологически: первый      ║
║ показывает начальное впечатление, второй -       ║
║ устойчивое влияние, что подчёркивает             ║
║ закономерность воздействия чтения."              ║
╠══════════════════════════════════════════════════╣
║ ... (остальные критерии)                         ║
╠══════════════════════════════════════════════════╣
║ К8. Пунктуация                      2 / 3  ~    ║
║ ─────────────────────────────────────────────    ║
║ Обнаружены 2 пунктуационные ошибки:              ║
║                                                  ║
║ ❌ 1. После 'Например' нужна запятая:            ║
║    "Например**,** читая произведения..."         ║
║                                                  ║
║ ❌ 2. После 'Таким образом' нужна запятая:       ║
║    "Таким образом**,** чтение..."                ║
╠══════════════════════════════════════════════════╣
║ ИТОГО:                             23 / 25       ║
║                                                  ║
║ 🎉 Отличный результат! Ещё 2 балла и будет 25!  ║
╚══════════════════════════════════════════════════╝
```

---

## 💸 Стоимость этой проверки

### Детали запроса

- **Input tokens**: ~850 (системный промпт + критерии + примеры + ответ студента)
- **Output tokens**: ~650 (JSON с детализацией по всем критериям)
- **Провайдер**: DeepSeek V3
- **Цены**: $0.14/1M input, $0.28/1M output

### Расчёт

```
Стоимость = (850 × $0.14 + 650 × $0.28) / 1,000,000
          = ($119 + $182) / 1,000,000
          = $301 / 1,000,000
          = $0.000301
          ≈ $0.0003  (~0.023₽)
```

**С учётом Batch API** (50% скидка):
- **$0.00015** (~0.011₽)

**С учётом кеша** (если похожий ответ уже проверялся):
- **$0.000** (бесплатно из кеша!)

---

## 📈 Статистика по классу (для учителя)

После проверки 28 работ:

```
╔══════════════════════════════════════════════════╗
║ Статистика: "Сочинение ЕГЭ - Задание 27"         ║
╠══════════════════════════════════════════════════╣
║ Проверено: 28 / 28  (100%)                       ║
║ Средний балл: 21.4 / 25                          ║
║                                                  ║
║ Распределение:                                   ║
║   24-25 баллов: ████████████ 12 учеников (43%)   ║
║   20-23 балла:  ████████ 10 учеников (36%)       ║
║   15-19 баллов: ████ 5 учеников (18%)            ║
║   0-14 баллов:  █ 1 ученик (3%)                  ║
╠══════════════════════════════════════════════════╣
║ Проблемные критерии (частые ошибки):             ║
║   К2 (комментарий): 14 работ < 6 баллов (50%)    ║
║   К8 (пунктуация): 18 работ < 3 баллов (64%)     ║
║   К10 (речевые нормы): 8 работ < 2 баллов (29%)  ║
╠══════════════════════════════════════════════════╣
║ Стоимость проверки: $0.0084  (~0.63₽)            ║
║ Время проверки: 1 мин 45 сек (batch)             ║
║ Из кеша: 3 работы (11%)                          ║
╠══════════════════════════════════════════════════╣
║ Требуется внимание учителя: 2 работы             ║
║   - Петров И. (низкая уверенность AI: 68%)       ║
║   - Сидорова М. (возможный плагиат - предупр.)   ║
╚══════════════════════════════════════════════════╝
```

---

## 🎯 Итого

**Этот пример показывает:**
1. ✅ AI точно следует критериям ФИПИ
2. 📊 Детализация по каждому критерию
3. 💬 Конструктивный фидбек для ученика
4. 💰 Стоимость < $0.001 за проверку
5. ⚡ Проверка за ~5 секунд (или 2 мин для batch)
6. 🎓 Учитель может изменить любую оценку

**Качество AI проверки: 92% confidence = практически не требует правки.**
