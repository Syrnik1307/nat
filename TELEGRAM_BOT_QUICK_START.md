# üéØ Telegram Bot - –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ

**–í–µ—Å—å –∫–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ 100%:**
- ‚úÖ `telegram_bot.py` - –±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ /start, /link, /menu, /homework
- ‚úÖ `accounts/notifications.py` - —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ `homework/views.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –î–ó
- ‚úÖ –ú–æ–¥–µ–ª–∏ NotificationSettings, NotificationLog –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ Frontend —Å –∫–Ω–æ–ø–∫–æ–π "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"

**–ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ:**
1. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather (5 –º–∏–Ω—É—Ç)
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ `.env` —Ñ–∞–π–ª
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (5 –º–∏–Ω—É—Ç)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather)
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
4. –ò–º—è –±–æ—Ç–∞: `Teaching Panel Bot` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ)
5. Username: `teaching_panel_bot` (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `_bot`)
6. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω** (—Ñ–æ—Ä–º–∞—Ç: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ .env

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `teaching_panel\.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```bash
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–û—Ç–∫—Ä–æ–π—Ç–µ PowerShell:

```powershell
cd teaching_panel
..\venv\Scripts\Activate.ps1
python create_test_data_for_bot.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –£—á–∏—Ç–µ–ª—å: `teacher.bot@test.com` (–ø–∞—Ä–æ–ª—å: `test123`)
- ‚úÖ –°—Ç—É–¥–µ–Ω—Ç: `student.bot@test.com` (–ø–∞—Ä–æ–ª—å: `test123`)
- ‚úÖ –ì—Ä—É–ø–ø–∞ —Å invite code (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ABC123`)
- ‚úÖ –î–ó "–¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" (—á–µ—Ä–Ω–æ–≤–∏–∫, –≥–æ—Ç–æ–≤–æ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏)

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å Django + –±–æ—Ç–∞

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - Django:**
```powershell
cd teaching_panel
..\venv\Scripts\Activate.ps1
python manage.py runserver
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - Telegram –±–æ—Ç:**
```powershell
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
.\start_bot.ps1
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
```powershell
cd teaching_panel
..\venv\Scripts\Activate.ps1
python telegram_bot.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
INFO - Bot started successfully! Username: @teaching_panel_bot
INFO - Polling for updates...
```

### –®–∞–≥ 5: –°–≤—è–∑–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram (`@teaching_panel_bot`)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"üîó –ü—Ä–∏–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç"**
4. –í–≤–µ–¥–∏—Ç–µ invite code –∏–∑ –≤—ã–≤–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ABC123`)
5. –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏: **"‚úÖ –í–∞—à –∞–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!"**

### –®–∞–≥ 6: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –î–ó

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å: `teacher.bot@test.com` / `test123`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Homework** ‚Üí **"–¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"**
4. –ù–∞–∂–º–∏—Ç–µ **"üì¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"**
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ"
- ‚úÖ Badge –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ"
- ‚úÖ **–í Telegram –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç—É:**

```
üìö –ù–æ–≤–æ–µ –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –£—á–∏—Ç–µ–ª–µ–≤
–ì—Ä—É–ø–ø–∞: –¢–µ—Å—Ç–æ–≤–∞—è –≥—Ä—É–ø–ø–∞ –¥–ª—è –±–æ—Ç–∞
–°—Ç–∞—Ä—Ç —É—Ä–æ–∫–∞: 29.11 12:00
–ó–∞–π–¥–∏—Ç–µ –≤ Teaching Panel, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏.
```

### –®–∞–≥ 7: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–¥–∞—á—É –î–ó

1. –í—ã–π–¥–∏—Ç–µ –∏–∑ —É—á–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç: `student.bot@test.com` / `test123`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Homework** ‚Üí **"–¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ **"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **–£—á–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram:**

```
üìù –°—Ç—É–¥–µ–Ω—Ç —Å–¥–∞–ª –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
–°—Ç—É–¥–µ–Ω—Ç: –ü–µ—Ç—Ä –°—Ç—É–¥–µ–Ω—Ç–æ–≤
–î–ó: –¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –≤ Teaching Panel.
```

### –®–∞–≥ 8: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ü–µ–Ω–∫—É –î–ó

1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Homework ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—ã**
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–±–æ—Ç—É —Å—Ç—É–¥–µ–Ω—Ç–∞
4. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **–°—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram:**

```
‚úÖ –í–∞—à–∞ –¥–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞!
–î–ó: –¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
–û—Ü–µ–Ω–∫–∞: 10/10
–û—Ç–∫—Ä–æ–π—Ç–µ Teaching Panel –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
```

---

## üåê –î–µ–ø–ª–æ–π –Ω–∞ production

### –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
ssh tp
cd /var/www/teaching_panel
nano .env
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
# TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
# Ctrl+O, Enter, Ctrl+X
```

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
source venv/bin/activate
pip install python-telegram-bot==20.7
```

### –°–æ–∑–¥–∞—Ç—å systemd service

```bash
sudo nano /etc/systemd/system/telegram-bot.service
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```ini
[Unit]
Description=Teaching Panel Telegram Bot
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/teaching_panel
Environment="PATH=/var/www/teaching_panel/venv/bin"
ExecStart=/var/www/teaching_panel/venv/bin/python /var/www/teaching_panel/telegram_bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É

```bash
sudo systemctl daemon-reload
sudo systemctl enable telegram-bot
sudo systemctl start telegram-bot
sudo systemctl status telegram-bot
```

### –†–µ—Å—Ç–∞—Ä—Ç Django

```bash
sudo systemctl restart gunicorn
```

---

## üêõ Troubleshooting

### "Telegram bot token is not configured"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env`:
```powershell
Get-Content teaching_panel\.env | Select-String "TELEGRAM"
```

–ï—Å–ª–∏ –ø—É—Å—Ç–æ - –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω:
```powershell
"TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω" | Add-Content teaching_panel\.env
```

### "Missing telegram_chat_id"

–°—Ç—É–¥–µ–Ω—Ç –Ω–µ —Å–≤—è–∑–∞–ª –∞–∫–∫–∞—É–Ω—Ç - –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –®–∞–≥ 5.

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω:
```powershell
cd teaching_panel
..\venv\Scripts\Activate.ps1
python -c "from telegram_bot import BOT_TOKEN; print(BOT_TOKEN[:20])"
```

–ï—Å–ª–∏ –≤—ã–≤–æ–¥–∏—Ç "YOUR_BOT_TOKEN_HERE" - —Ç–æ–∫–µ–Ω –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ .env.

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ NotificationSettings –≤ Django Admin:
- `telegram_enabled` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω
- `notify_new_homework` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `TELEGRAM_BOT_FULL_FLOW_TEST.md` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

---

**–í—Ä–µ–º—è –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É:** 10-15 –º–∏–Ω—É—Ç  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 29.11.2024
