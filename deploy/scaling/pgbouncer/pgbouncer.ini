# =============================================================================
# PgBouncer Configuration for Stage B+
# Install: sudo apt install pgbouncer
# Config: /etc/pgbouncer/pgbouncer.ini
# =============================================================================

[databases]
# Format: dbname = host=... port=... dbname=...
teaching_panel = host=127.0.0.1 port=5432 dbname=teaching_panel

# For remote PostgreSQL:
# teaching_panel = host=db.example.com port=5432 dbname=teaching_panel

[pgbouncer]
# Connection settings
listen_addr = 127.0.0.1
listen_port = 6432
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

# Pool mode: transaction is optimal for Django
# - session: connection per session (defeats purpose)
# - transaction: connection per transaction (recommended)
# - statement: connection per statement (not for Django)
pool_mode = transaction

# Pool sizing
# default_pool_size Ã— number_of_databases = max connections to PG
default_pool_size = 25
min_pool_size = 5
reserve_pool_size = 5
reserve_pool_timeout = 3

# Client connections
max_client_conn = 200
max_db_connections = 50

# Timeouts
server_connect_timeout = 10
server_idle_timeout = 300
client_idle_timeout = 300
query_timeout = 30
query_wait_timeout = 60

# Logging
log_connections = 0
log_disconnections = 0
log_pooler_errors = 1
stats_period = 60

# Admin access
admin_users = postgres
stats_users = postgres

# =============================================================================
# userlist.txt format (create /etc/pgbouncer/userlist.txt):
# "username" "password"
# 
# Example:
# "teaching_panel" "md5xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
#
# Generate md5 password:
# echo -n "passwordusername" | md5sum
# Prepend "md5" to result
# =============================================================================
