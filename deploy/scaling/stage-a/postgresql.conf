# =============================================================================
# PostgreSQL Configuration for Stage A (4GB RAM server)
# Append to /etc/postgresql/XX/main/postgresql.conf
# =============================================================================

# CONNECTIONS
max_connections = 50                    # Gunicorn(3) + Celery(2) + Beat(1) + Admin(2) + buffer
superuser_reserved_connections = 3

# MEMORY (25% of 4GB = 1GB for shared_buffers)
shared_buffers = 1GB
effective_cache_size = 2GB              # 50% of RAM for cache estimation
work_mem = 32MB                         # Per-operation memory
maintenance_work_mem = 256MB            # For VACUUM, CREATE INDEX

# WRITE AHEAD LOG
wal_buffers = 64MB
checkpoint_completion_target = 0.9
max_wal_size = 2GB
min_wal_size = 512MB

# QUERY PLANNER
random_page_cost = 1.1                  # SSD optimization
effective_io_concurrency = 200          # SSD optimization
default_statistics_target = 100

# LOGGING (production)
log_min_duration_statement = 1000       # Log queries > 1 second
log_checkpoints = on
log_connections = off                   # Reduce log noise
log_disconnections = off
log_lock_waits = on
log_temp_files = 0

# AUTOVACUUM (conservative for small instance)
autovacuum_max_workers = 2
autovacuum_naptime = 60s
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50

# STATEMENT TIMEOUT (matches Django settings)
statement_timeout = 30000               # 30 seconds
