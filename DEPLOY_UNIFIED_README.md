# üöÄ deploy_unified.ps1 - –ï–¥–∏–Ω—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –¥–µ–ø–ª–æ–π

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 7 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** Production ready

## –ß—Ç–æ —ç—Ç–æ?

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±–µ –Ω—É–∂–µ–Ω. –ó–∞–º–µ–Ω—è–µ—Ç 16+ —Å—Ç–∞—Ä—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é.

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (backend + frontend):**
```powershell
.\deploy_unified.ps1 -Action full
```

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é:**
```powershell
.\deploy_unified.ps1
```

## üìã –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (Full)
```powershell
.\deploy_unified.ps1 -Action full
```
- –ë—ç–∫–∞–ø –ë–î + –∫–æ–¥
- Git pull
- Pip install (–µ—Å–ª–∏ requirements.txt –∏–∑–º–µ–Ω–∏–ª—Å—è)
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
- Collectstatic
- Restart —Å–µ—Ä–≤–∏—Å–æ–≤
- Health checks
- **Auto-rollback** –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ

### 2. –¢–æ–ª—å–∫–æ Backend
```powershell
.\deploy_unified.ps1 -Action backend
```
- –í—Å—ë —Ç–æ –∂–µ, –Ω–æ –±–µ–∑ frontend

### 3. –¢–æ–ª—å–∫–æ Frontend (–∞—Ç–æ–º–∞—Ä–Ω—ã–π)
```powershell
.\deploy_unified.ps1 -Action frontend
```
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
- Fix permissions
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞ (~–º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞)
- Health check
- –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

### 4. –ë—ã—Å—Ç—Ä—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç
```powershell
.\deploy_unified.ps1 -Action quick
```
- –ü—Ä–æ—Å—Ç–æ —Ä–µ—Å—Ç–∞—Ä—Ç —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
- –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è config changes

### 5-7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Health check
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (Django, Nginx, systemd)

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø
–°–æ–∑–¥–∞—ë—Ç—Å—è –î–û –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
/tmp/deploy_20260207_143052.sqlite3
```
–° –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ `PRAGMA integrity_check`.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç
–ü—Ä–∏ –õ–Æ–ë–û–ô –æ—à–∏–±–∫–µ:
1. Git reset –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
2. Restart —Å–µ—Ä–≤–∏—Å–æ–≤
3. Health check
4. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Ä—É—á–Ω–æ–º—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é

### Health Checks
- **–î–æ –¥–µ–ø–ª–æ—è:** –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ production —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:** 5 –ø–æ–ø—ã—Ç–æ–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 3 —Å–µ–∫
- **Timeout:** 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **Endpoint:** https://lectiospace.ru/api/health/

## üéØ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ** –∏–º–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):
- `teaching_panel` - production (–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ)
- `teaching-panel-stage` - staging (–¥–µ—Ñ–∏—Å)
- –ü—É—Ç—å: `/var/www/teaching_panel/` (–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ)

**–°—Ç–∞—Ä—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞, –ø–æ—ç—Ç–æ–º—É –¥–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–ª!**

## üìä –û–ø—Ü–∏–∏

```powershell
# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç)
.\deploy_unified.ps1 -Action full -DryRun

# –ë–µ–∑ health checks (—ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π)
.\deploy_unified.ps1 -Action full -SkipHealthCheck

# –ë–µ–∑ –±—ç–∫–∞–ø–∞ (–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø!)
.\deploy_unified.ps1 -Action full -SkipBackup

# –ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º)
.\deploy_unified.ps1 -Action full -Force
```

## üö¶ Workflow

### –û–±—ã—á–Ω—ã–π –¥–µ–ø–ª–æ–π

```powershell
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
.\deploy_unified.ps1

# 2. –í—ã–±—Ä–∞—Ç—å "1 - –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π"

# 3. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
#    - –ü—Ä–æ–≤–µ—Ä–∏—Ç SSH
#    - –°–æ–∑–¥–∞—Å—Ç –±—ç–∫–∞–ø
#    - –ü–æ–∫–∞–∂–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git
#    - –ü–æ–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
#    - –ü—Ä–∏–º–µ–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
#    - –ü—Ä–æ–≤–µ—Ä–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å - –ø–æ–ø—Ä–æ—Å–∏—Ç MIGRATE)
#    - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã
#    - –ü—Ä–æ–≤–µ—Ä–∏—Ç health check
#    - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –æ—Ç–∫–∞—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# 4. –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏:
ssh tp 'sudo tail -f /var/log/teaching_panel/error.log'
```

### Frontend hotfix

```powershell
# –õ–æ–∫–∞–ª—å–Ω–æ:
cd frontend
npm run build

# –î–µ–ø–ª–æ–π:
.\deploy_unified.ps1 -Action frontend
```

### Backend hotfix

```powershell
# –ü—Ä–æ—Å—Ç–æ:
.\deploy_unified.ps1 -Action backend
```

## üìù –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –¥–µ–ø–ª–æ–π –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è?

### –°–ª—É—á–∞–π 1: –°–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∏–ª—Å—è —Å–∞–º
```
‚ùå === –û–¢–ö–ê–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô ===
  –ü—Ä–∏—á–∏–Ω–∞: Health check –ø—Ä–æ–≤–∞–ª–µ–Ω
  
‚úÖ –û—Ç–∫–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
```
**–î–µ–π—Å—Ç–≤–∏—è:** –í—Å—ë –û–ö, –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã, production —Ä–∞–±–æ—Ç–∞–µ—Ç.

### –°–ª—É—á–∞–π 2: –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç –Ω–µ –ø–æ–º–æ–≥
```
‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –û—Ç–∫–∞—Ç –Ω–µ –ø–æ–º–æ–≥!

–†–£–ß–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï:
  1. ssh tp
  2. cd /var/www/teaching_panel
  3. sudo git reset --hard abc123
  4. sudo systemctl restart teaching_panel
  5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î: sudo cp /tmp/deploy_20260207_143052.sqlite3 teaching_panel/db.sqlite3
```

**–î–µ–π—Å—Ç–≤–∏—è:** –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ, —Å–≤—è–∑—ã–≤–∞–π—Å—è —Å —Ç–∏–º–ª–∏–¥–æ–º.

### –°–ª—É—á–∞–π 3: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–ª–æ–º–∞–ª–∞ –ë–î
```powershell
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
ssh tp
cd /var/www/teaching_panel/teaching_panel
sudo cp /tmp/deploy_YYYYMMDD_HHMMSS.sqlite3 db.sqlite3
sudo chown www-data:www-data db.sqlite3
sudo systemctl restart teaching_panel
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

```powershell
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
.\deploy_unified.ps1

# 2. –í—ã–±—Ä–∞—Ç—å "6 - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤"
#    –£–≤–∏–¥–∏—à—å –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

# 3. –í—ã–±—Ä–∞—Ç—å "7 - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
#    –ü–æ—Å–º–æ—Ç—Ä–∏ Django error log

# 4. Health check
.\deploy_unified.ps1 -Action quick
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**Health check timeout:**
- Gunicorn –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å
- –†–µ—à–µ–Ω–∏–µ: –ø–æ–¥–æ–∂–¥–∏ 30 —Å–µ–∫, –∑–∞–ø—É—Å—Ç–∏ `.\deploy_unified.ps1 -Action quick`

**403 Forbidden –Ω–∞ —Å—Ç–∞—Ç–∏–∫–µ:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
- –†–µ—à–µ–Ω–∏–µ: –≤ —Å–∫—Ä–∏–ø—Ç–µ –µ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fix-Permissions

**–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å:**
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–∏–≥—Ä–∞—Ü–∏–π
- –†–µ—à–µ–Ω–∏–µ: –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç, –ø–æ—Ç–æ–º –ª–æ–∫–∞–ª—å–Ω–æ `python manage.py makemigrations --merge`

## üéì –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –¥–Ω—è
```powershell
# –ú—è–≥–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç –¥–ª—è "–ø—Ä–æ–≥—Ä–µ–≤–∞"
.\deploy_unified.ps1 -Action quick

# –î–µ–ø–ª–æ–π
.\deploy_unified.ps1 -Action full
```

### –ü—Ä–∏–º–µ—Ä 2: Hotfix –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –±–∞–≥–∏–Ω—ã
```powershell
# –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
.\deploy_unified.ps1 -Action backend -Force
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º
```powershell
# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
.\deploy_unified.ps1 -Action full -DryRun

# –ï—Å–ª–∏ –≤—Å—ë –û–ö - —Ä–µ–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π
.\deploy_unified.ps1 -Action full
```

### –ü—Ä–∏–º–µ—Ä 4: Staging deploy (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
```powershell
# –ù—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä -Environment
.\deploy_unified.ps1 -Action full -Environment staging
```

## üóëÔ∏è –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–∫—Ä–∏–ø—Ç—ã

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- ‚ùå `deploy_to_production.ps1` - –æ–±—ä–µ–¥–∏–Ω—ë–Ω –≤ unified
- ‚ùå `auto_deploy.ps1` - –æ–±—ä–µ–¥–∏–Ω—ë–Ω –≤ unified
- ‚ùå `deploy.ps1` - –æ–±—ä–µ–¥–∏–Ω—ë–Ω –≤ unified
- ‚ùå `deploy_simple.ps1` - –æ–±—ä–µ–¥–∏–Ω—ë–Ω –≤ unified
- ‚ùå `deploy_multi.ps1` - –æ–±—ä–µ–¥–∏–Ω—ë–Ω –≤ unified
- ‚ùå `deploy_frontend.ps1` - –æ–±—ä–µ–¥–∏–Ω—ë–Ω –≤ unified

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤—å –∏—Ö –ø–æ–∫–∞ –¥–ª—è reference, –Ω–æ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `deploy_unified.ps1`.

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `DEPLOY_PROBLEMS_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –¥–µ–ø–ª–æ—è
- `DEPLOY_PROBLEMS_SOLUTION.md` - –ø–ª–∞–Ω —Ä–µ—à–µ–Ω–∏—è
- `DEPLOY_FIX_REPORT.md` - —á—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- `SERVICE_NAMING_FINAL_ANALYSIS.md` - –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–º—ë–Ω

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ó–∞–ø—É—Å—Ç–∏ `.\deploy_unified.ps1` ‚Üí "6 - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤"
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ "7 - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
3. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç–∫–∞—Ç - —Å–∫—Ä–∏–ø—Ç —Å–¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - –Ω–∞–π–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø –≤ `/tmp/deploy_*.sqlite3`

**–í–∞–∂–Ω–æ:** –°–∫—Ä–∏–ø—Ç –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç –±—ç–∫–∞–ø –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–∞–∫ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

---

**Status:** ‚úÖ Production ready  
**Last update:** 7 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç
