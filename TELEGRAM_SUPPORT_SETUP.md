# üì± Telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram:
- ‚úÖ –ê–¥–º–∏–Ω—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–∞—Ö
- ‚úÖ –ê–¥–º–∏–Ω—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- ‚úÖ –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –æ—Ç–≤–µ—á–∞—Ç—å **–ø—Ä—è–º–æ –∏–∑ Telegram**
- ‚úÖ –û—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —á–µ—Ä–µ–∑ Telegram

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ Telegram-–±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Support Helper")
4. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ username (–Ω–∞–ø—Ä–∏–º–µ—Ä, "YourSchoolSupportBot")
5. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω** (—Ñ–æ—Ä–º–∞—Ç: `123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`)

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

**Windows (PowerShell):**
```powershell
$env:SUPPORT_BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_botfather"
```

**–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (Windows):**
```powershell
[System.Environment]::SetEnvironmentVariable('SUPPORT_BOT_TOKEN', '–≤–∞—à_—Ç–æ–∫–µ–Ω', 'User')
```

**Linux/Mac:**
```bash
export SUPPORT_BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_botfather"
```

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:
```
SUPPORT_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_botfather
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)

```bash
cd teaching_panel
pip install python-telegram-bot requests
```

### 4. –ü—Ä–∏–≤—è–∂–∏—Ç–µ Telegram ID –∫ –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç—É

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ Django Admin**

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `python manage.py runserver`
2. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/accounts/customuser/`
3. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
4. –í –ø–æ–ª–µ `telegram_id` –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID (–ø–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ –±–æ—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)**

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ (—Å–º. –Ω–∏–∂–µ)
2. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start` –≤ Telegram
3. –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à Telegram ID
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Django Admin

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**

```bash
cd teaching_panel
python support_bot.py
```

**–î–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (Linux/Mac):**
```bash
nohup python support_bot.py > support_bot.log 2>&1 &
```

**–î–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (Windows - —á–µ—Ä–µ–∑ Task Scheduler –∏–ª–∏ nssm):**
```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nssm (Non-Sucking Service Manager)
# –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–π—Ç–µ —Å–ª—É–∂–±—É:
nssm install SupportBot "C:\path\to\.venv\Scripts\python.exe" "C:\path\to\teaching_panel\support_bot.py"
nssm start SupportBot
```

### 6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
4. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–∏–∫–µ—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
5. –í—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram!

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω–∞ |
| `/tickets` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ (–¥–æ 10) |
| `/my` | –í–∞—à–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã |
| `/view_<id>` | –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–∫–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/view_5`) |
| `/reply <id> <—Ç–µ–∫—Å—Ç>` | –û—Ç–≤–µ—Ç –Ω–∞ —Ç–∏–∫–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/reply 5 –ü—Ä–∏–≤–µ—Ç, —á–µ–º –ø–æ–º–æ—á—å?`) |
| `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∏–∫–µ—Ç–∞:**
```
/view_23
```

**–û—Ç–≤–µ—Ç –Ω–∞ —Ç–∏–∫–µ—Ç:**
```
/reply 23 –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.
```

**–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (–ø–æ—Å–ª–µ /view):**
–ï—Å–ª–∏ –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∏ —Ç–∏–∫–µ—Ç —á–µ—Ä–µ–∑ `/view_23`, –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–µ–π—á–∞—Å –≤—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
```
–ò –æ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –∫–∞–∫ –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–∏–∫–µ—Ç #23.

## üîî –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ù–æ–≤—ã–π —Ç–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω

–í—Å–µ –∞–¥–º–∏–Ω—ã —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º Telegram –ø–æ–ª—É—á–∞—Ç:

```
üÜï –ù–æ–≤—ã–π —Ç–∏–∫–µ—Ç #42

üü° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –û–±—ã—á–Ω—ã–π
üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: technical
üìù –¢–µ–º–∞: –ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
üìÑ –û–ø–∏—Å–∞–Ω–∏–µ:
–ü—Ä–∏ –≤—Ö–æ–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "Invalid credentials"...

üë§ –û—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: /view_42
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

–ï—Å–ª–∏ —Ç–∏–∫–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω –≤–∞–º - –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

```
üí¨ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–∏–∫–µ—Ç–µ #42

üìù –¢–µ–º–∞: –ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
üë§ –û—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üíå –°–æ–æ–±—â–µ–Ω–∏–µ:
–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å! –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª, –Ω–æ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç...

–î–ª—è –æ—Ç–≤–µ—Ç–∞: /view_42
```

## üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏

–ü–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã `/view_<id>` –≤—ã —É–≤–∏–¥–∏—Ç–µ –∫–Ω–æ–ø–∫–∏:

- **‚úçÔ∏è –û—Ç–≤–µ—Ç–∏—Ç—å** - –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- **üë§ –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–µ–±–µ** - –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ç–∏–∫–µ—Ç –≤–∞–º
- **‚úÖ –†–µ—à—ë–Ω** - –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å "–†–µ—à—ë–Ω"
- **üîÑ –í —Ä–∞–±–æ—Ç–µ** - –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å "–í —Ä–∞–±–æ—Ç–µ"

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã

### –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–û—Ç–∫—Ä–æ–π—Ç–µ `support_bot.py` –∏ –Ω–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `view_ticket`. –ò–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:

```python
message = (
    f"*–¢–∏–∫–µ—Ç #{ticket.id}*\n\n"
    f"üìù *–¢–µ–º–∞:* {ticket.subject}\n"
    # –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –ø–æ–ª—è
)
```

### –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤ /tickets

–í —Ñ—É–Ω–∫—Ü–∏–∏ `tickets()`:

```python
# –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ä–æ—á–Ω—ã–µ
open_tickets = SupportTicket.objects.filter(
    status__in=['new', 'in_progress'],
    priority='urgent'  # –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä
).order_by('-created_at')[:10]
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–º—É –∞–¥–º–∏–Ω—É

–í —Ñ–∞–π–ª–µ `support/views.py`, —Ñ—É–Ω–∫—Ü–∏—è `_notify_admins_new_message()`:

```python
# –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ! –ï—Å–ª–∏ —Ç–∏–∫–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–¥—ë—Ç —Ç–æ–ª—å–∫–æ –µ–º—É
if ticket.assigned_to and ticket.assigned_to.telegram_id:
    admins = [ticket.assigned_to]
else:
    admins = CustomUser.objects.filter(is_staff=True, telegram_id__isnull=False)
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–û—à–∏–±–∫–∞:** `‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω SUPPORT_BOT_TOKEN`

**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. —à–∞–≥ 2)

---

**–û—à–∏–±–∫–∞:** `ModuleNotFoundError: No module named 'telegram'`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install python-telegram-bot requests
```

### –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–ª–∏ —Ç–∏–∫–µ—Ç, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—à–ª–æ

**–ß–µ–∫–ª–∏—Å—Ç:**
1. ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω (`python support_bot.py`)
2. ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SUPPORT_BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
3. ‚úÖ –í Django Admin —É –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - –ì–∞–ª–æ—á–∫–∞ `is_staff` —Å—Ç–æ–∏—Ç
   - –ü–æ–ª–µ `telegram_id` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
4. ‚úÖ –í—ã –Ω–∞–ø–∏—Å–∞–ª–∏ –±–æ—Ç—É `/start` –∏ –æ–Ω –æ—Ç–≤–µ—Ç–∏–ª
5. ‚úÖ Django —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**

–û—Ç–∫—Ä–æ–π—Ç–µ `support/models.py`, —Ñ—É–Ω–∫—Ü–∏—è `_send_telegram_notification()`:

```python
# –î–æ–±–∞–≤—å—Ç–µ print –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç–∏–∫–µ—Ç–µ #{self.id}")
print(f"–ù–∞–π–¥–µ–Ω–æ –∞–¥–º–∏–Ω–æ–≤: {admins.count()}")
```

### –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∏—à—É –≤ Telegram, –Ω–æ –Ω–∞ —Å–∞–π—Ç–µ –Ω–µ –≤–∏–¥–Ω–æ –æ—Ç–≤–µ—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Django —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω. –ë–æ—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Django.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ - —Ç–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö.

### –ü–æ–ª—É—á–∞—é –æ—à–∏–±–∫—É "–°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å"

**–†–µ—à–µ–Ω–∏–µ:** 
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à `telegram_id` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω –≤ Django Admin
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ `is_staff=True`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞

```bash
# Linux/Mac
ps aux | grep support_bot.py

# Windows
Get-Process | Where-Object {$_.ProcessName -eq "python" -and $_.CommandLine -like "*support_bot*"}
```

### –õ–æ–≥–∏ –±–æ—Ç–∞

–ë–æ—Ç –≤—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏ –≤ stdout. –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:

```bash
python support_bot.py > support_bot.log 2>&1 &
tail -f support_bot.log  # –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ `/stats` –≤ Telegram:

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤: 142
üÜï –ù–æ–≤—ã—Ö: 5
üîÑ –í —Ä–∞–±–æ—Ç–µ: 12
‚è≥ –û–∂–∏–¥–∞—é—Ç –æ—Ç–≤–µ—Ç–∞: 8
‚úÖ –†–µ—à—ë–Ω–Ω—ã—Ö: 117

–í–∞—à–∏ —Ç–∏–∫–µ—Ç—ã:
üìå –í—Å–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ: 23
üî• –ê–∫—Ç–∏–≤–Ω—ã—Ö: 7
```

## üöÄ Production –¥–µ–ø–ª–æ–π

### Systemd (Linux)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/support-bot.service`:

```ini
[Unit]
Description=Support Telegram Bot
After=network.target

[Service]
Type=simple
User=youruser
WorkingDirectory=/path/to/teaching_panel
Environment="SUPPORT_BOT_TOKEN=your_token_here"
ExecStart=/path/to/.venv/bin/python support_bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
sudo systemctl daemon-reload
sudo systemctl enable support-bot
sudo systemctl start support-bot
sudo systemctl status support-bot
```

### Docker

–°–æ–∑–¥–∞–π—Ç–µ `Dockerfile.support-bot`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY teaching_panel/ .

ENV SUPPORT_BOT_TOKEN=""
ENV DJANGO_SETTINGS_MODULE=teaching_panel.settings

CMD ["python", "support_bot.py"]
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
docker build -f Dockerfile.support-bot -t support-bot .
docker run -d \
  --name support-bot \
  -e SUPPORT_BOT_TOKEN="your_token" \
  --network host \
  support-bot
```

### Supervisor (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è VPS)

–§–∞–π–ª `/etc/supervisor/conf.d/support-bot.conf`:

```ini
[program:support-bot]
directory=/home/user/teaching_panel
command=/home/user/.venv/bin/python support_bot.py
environment=SUPPORT_BOT_TOKEN="your_token"
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/support-bot.log
```

## üìà –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–∞

–í `support_bot.py`:

```python
async def close_ticket(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç /close <ticket_id>"""
    telegram_id = update.effective_user.id
    
    try:
        user = CustomUser.objects.get(telegram_id=telegram_id, is_staff=True)
    except CustomUser.DoesNotExist:
        await update.message.reply_text("‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω")
        return
    
    parts = update.message.text.split()
    if len(parts) < 2:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /close <ticket_id>")
        return
    
    ticket_id = int(parts[1])
    ticket = SupportTicket.objects.get(id=ticket_id)
    ticket.status = 'closed'
    ticket.save()
    
    await update.message.reply_text(f"‚úÖ –¢–∏–∫–µ—Ç #{ticket_id} –∑–∞–∫—Ä—ã—Ç")

# –í —Ñ—É–Ω–∫—Ü–∏–∏ main():
application.add_handler(CommandHandler("close", close_ticket))
```

### –ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–í–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞–∂–¥–æ–º—É –∞–¥–º–∏–Ω—É –æ—Ç–¥–µ–ª—å–Ω–æ, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É:

1. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É –≤ Telegram
2. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
3. –°–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–æ–º –≥—Ä—É–ø–ø—ã
4. –ü–æ–ª—É—á–∏—Ç–µ chat_id –≥—Ä—É–ø–ø—ã (–æ—Ç–ø—Ä–∞–≤—å—Ç–µ —á—Ç–æ-—Ç–æ –≤ –≥—Ä—É–ø–ø—É –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞)

–í `support/models.py`:

```python
# –í–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞–∂–¥–æ–º—É –∞–¥–º–∏–Ω—É
chat_id = -1001234567890  # ID –≤–∞—à–µ–π –≥—Ä—É–ø–ø—ã (—Å –º–∏–Ω—É—Å–æ–º!)
url = f"https://api.telegram.org/bot{token}/sendMessage"
data = {
    'chat_id': chat_id,
    'text': message,
    'parse_mode': 'Markdown'
}
requests.post(url, json=data)
```

## üéì –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:**
   - –ü–æ–ª—É—á–∏—Ç–µ Telegram ID –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
   - –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start`
   - –ñ–¥–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

2. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
   - –ü–æ–ª—É—á–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí `/view_<id>`
   - –ü—Ä–æ—á–∏—Ç–∞–ª–∏ ‚Üí –ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/reply`
   - –ó–∞–∫–æ–Ω—á–∏–ª–∏ ‚Üí –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚úÖ –†–µ—à—ë–Ω"

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:**
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ `/my` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ —Ç–∏–∫–µ—Ç—ã
   - `/stats` - –æ–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

- –õ–æ–≥–∏ –±–æ—Ç–∞: `tail -f support_bot.log`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã: Django Admin ‚Üí Support ‚Üí Tickets
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –°–æ–∑–¥–∞–π—Ç–µ —Ç–∏–∫–µ—Ç —á–µ—Ä–µ–∑ `/admin` –∏–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –°–æ–∑–¥–∞–Ω –±–æ—Ç —á–µ—Ä–µ–∑ @BotFather
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SUPPORT_BOT_TOKEN`
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `python-telegram-bot`
- [ ] –£ –∞–¥–º–∏–Ω–æ–≤ –≤ –±–∞–∑–µ –∑–∞–ø–æ–ª–Ω–µ–Ω `telegram_id`
- [ ] –£ –∞–¥–º–∏–Ω–æ–≤ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ `is_staff=True`
- [ ] –ó–∞–ø—É—â–µ–Ω `python support_bot.py`
- [ ] –ó–∞–ø—É—â–µ–Ω Django —Å–µ—Ä–≤–µ—Ä
- [ ] –ê–¥–º–∏–Ω—ã –Ω–∞–ø–∏—Å–∞–ª–∏ –±–æ—Ç—É `/start`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –æ—Ç–≤–µ—Ç –∏–∑ Telegram
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ (systemd/supervisor/docker)

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–∂–µ—Ç:
- –ü–æ–ª—É—á–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –û—Ç–≤–µ—á–∞—Ç—å –Ω–µ –∑–∞—Ö–æ–¥—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
- –†–∞–±–æ—Ç–∞—Ç—å –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π Telegram
- –í–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–æ–∫—Ä–∞—Ç–∏—Ç—Å—è –≤ 10 —Ä–∞–∑!** ‚ö°
