# MASTER PLAN — Обновлённый (предложение)

Дата: 2025-11-17
Автор: команда разработки (предложение)

**Кратко:** этот документ — актуализированный мастер-план для Teaching Panel LMS. В нём собраны: текущий статус, приоритеты, план работ по модулям, оценки времени, список предложений по очистке репозитория и безопасный процесс удаления/архивации.

---

## 1. Цели проекта (высокоуровнево)
- Доставить стабильный Core-модуль (авторизация, расписание, Zoom Pool, посещаемость).
- Завершить модуль Homework & Analytics (UI + backend автоматизированной оценки).
- Построить надёжный Chat (реалтайм, файлообмен, уведомления).
- Обеспечить CI/tests, документирование и аккуратный репозиторий.

---

## 2. Текущий статус (сводка)
- Core (frontend + backend) — большая часть функционала реализована: регистрация, Zoom Pool, интеграция start-new, Celery задачи, frontend интеграция (Calendar, StartLessonButton, ZoomPoolManager). Большинство endpoint'ов и UI элементов есть.
- Cosmos DB — есть прототип клиента, репозиториев и миграций (feature-flagged).
- Homework — фронтенд и hook `useHomeworkSession` реализованы, авто‑сохранение и draft в localStorage, есть тесты в процессе стабилизации.
- Chat — спецификация есть, реализация ожидает старт (по плану другой участник).
- Документация — много отдельных md-файлов, часть — исторические/дубликаты.

---

## 3. Проблемы и риски (к текущему моменту)
- Тестовая среда: часть unit-тестов нестабильна из-за несовместимости моков/формата API; нужны небольшие рефакторы и настройка jest setupFiles.
- В репозитории много устаревшей/дублирующей документации, что затрудняет навигацию.
- Некоторые временные правки (CommonJS экспорт хука, debug-логи) нужно откатить/зафиксировать в чистом виде.
- Нет централизованного CHANGELOG и инфраструктуры CI, которая бы прогоняла тесты и сборки автоматически.

---

## 4. Рекомендованный поэтапный план (детально)
Каждый этап — краткое описание + owner + оценка времени.

### Фаза A — Стабилизация инфраструктуры (high priority)
- A.1 Настроить CI (GitHub Actions / Azure Pipelines): прогон `npm ci && npm test && npm run build` и `python -m pytest` для backend. (Owner: DevOps / ты) — 4-8ч
- A.2 Добавить `jest` setupFiles (jsdom) и унифицировать mock-стратегию (использовать dependency injection или spyOn вместо смешанных jest.mock). (Owner: Frontend) — 2-4ч
- A.3 Откатить временные debug правки и вернуть хук `useHomeworkSession` к чистому ESM экспорту; либо согласовать экспорт и update тестов. (Owner: Frontend) — 1-2ч

**Причина:** стабильная CI и чистая тестовая среда позволят быстрее безопасно вносить изменения.

---

### Фаза B — Завершение Core (функционал + качество)
- B.1 Расширить тесты: покрыть сценарии освобождения Zoom-аккаунта после урока, edge-cases start_new. (Owner: Backend) — 3-6ч
- B.2 Реализовать единый Zoom service (интерфейс) и подключение реального клиента (флаг feature) + retry/429 handling. (Owner: Backend) — 8-16ч
- B.3 Метрики Celery (expose metrics endpoint / Prometheus exporter) + логирование долгих задач. (Owner: Backend) — 4-8ч

---

### Фаза C — Homework & Analytics (доводка и интеграция)
- C.1 Финализировать UI прохождения ДЗ: QuestionRenderer для всех 8 типов, ProgressBar, QuestionNav. (Owner: Tihon / Frontend) — 6-12ч
- C.2 Закончить API: saveProgress PATCH контракт, submit POST, error handling, и endpoint docs. (Owner: Backend) — 3-6ч
- C.3 Тесты: unit tests для `useHomeworkSession`, интеграционные тесты эндпоинтов. (Owner: Frontend + Backend) — 4-8ч

---

### Фаза D — Chat System (параллельно)
- D.1 Проектирование WebSocket schema и авторизации (по токену). (Owner: Chat dev) — 4-6ч
- D.2 Реализация: server (channels / socket.io), клиентский компонент, хранение сообщений. (Owner: Chat dev) — 16-30ч
- D.3 Тестирование и мониторинг. (Owner: Chat dev) — 3-6ч

---

### Фаза E — Документация, релизная подготовка
- E.1 Составить CHANGELOG и RELEASE notes (по функциональным веткам). — 2-3ч
- E.2 Написать краткие How-to: локальная разработка, запуск тестов, как добавлять Zoom аккаунт, как seed-ить тестовые данные. — 4-6ч
- E.3 Провести ручное smoke-test (end-to-end): регистрация, создание урока, запуск урока, submit homework. — 4-6ч

---

## 5. Управление удалением/очисткой репозитория (предложение)
Репозиторий содержит много md-файлов с историей и дублирующей информацией. Чтобы не потерять историю, предлагаю рабочую процедуру:
1. Собрать кандидатов на удаление (ниже — первоначальный список).
2. Перенести кандидаты в `archive/docs/` в ветке `chore/cleanup/docs` (это безопаснее и позволяет реверт). Команда: `git mv file archive/docs/` и коммит.
3. После согласования и 7 дней без возражений — удалить.

Преимущество: можно быстро вернуть при ошибке и одновременно уменьшить шум в корне репозитория.

**Первичный список кандидатов (предложение на ревью):**
- `SUCCESS_REPORT.md` и `SUCCESS_REPORT_FINAL.md` (дубликаты)
- `FINAL_SUCCESS.md`
- `REDESIGN_DOCUMENTATION.md`, `REDESIGN_QUICK_START.md`, `REDESIGN_SUCCESS.md`
- `IMPROVEMENTS_REPORT.md` (если есть дубли/старый контент)
- `SUMMARY.md` (если дублируется в `MASTER_PLAN.md`)
- `CORE_MODULE_COMPLETED.md` (если фактически дублирует `CORE_MODULE_FINAL_REPORT.md`)
- `tempCodeRunnerFile.python` (временный — удалить)
- `START_HERE.md` (если устарел и заменён `README.md`)
- `API_DOCS.md` — если присутствуют актуальные API в виде OpenAPI/Swagger, держать, иначе переместить в `archive/docs/api/`.

> Примечание: точный список согласуем с вами; я не буду удалять файлы без подтверждения.

---

## 6. Конкретные команды (PowerShell) для безопасной архивации
(выполнять из корня `c:\Users\User\Desktop\WEB panel`)

```powershell
# Создать ветку для уборки
git checkout -b chore/cleanup/docs

# Создать папку archive и переместить файлы
mkdir archive\docs
git mv SUCCESS_REPORT.md archive/docs/ || echo 'not found'
git mv SUCCESS_REPORT_FINAL.md archive/docs/ || echo 'not found'
# Повторить для остальных файлов...

# Коммит и пуш
git add archive/docs
git commit -m "chore: move historical docs to archive/docs"
git push -u origin chore/cleanup/docs
```

Если вы хотите немедленно удалить (dangerous):

```powershell
# удалить файл локально и закоммитить удаление
git rm tempCodeRunnerFile.python
git commit -m "chore: remove temp file"
git push
```

---

## 7. Рекомендации по immediate next steps (что могу сделать прямо сейчас)
1. Завершить и сохранить этот `MASTER_PLAN_UPDATED.md` (готово). — выполнено.
2. Провести автоматический аудит файлов и вернуть список с размерами/дата модификации (я могу это сделать и вывести список). — *требует разрешения на запуск поиска по workspace*.
3. Перенести предложенные файлы в `archive/docs/` в новой ветке `chore/cleanup/docs` (я могу подготовить патч/PR). — *требует подтверждения списка для перемещения*.
4. Настроить CI workflow (я могу предложить файлы `.github/workflows/ci.yml`). — готов сделать по запросу.
5. Прогнать тесты локально (frontend/backend) и собрать лог ошибок (я могу запустить тесты и прислать отчёт). — требуется разрешение на запуск.

---

## 8. Что я сделал сейчас
- Создал этот файл `MASTER_PLAN_UPDATED.md` с обновлённым планом.
- Добавил базовый TODO-план в систему трекинга (task 1 помечен "in-progress").

---

## 9. Вопросы/решения для вас
- Подтвердите, пожалуйста, что из предложенного списка кандидатов на удаление вы соглашаетесь: я могу перенести эти файлы в `archive/docs/` (без окончательного удаления) и открыть PR. Если нужно — могу сразу удалить конкретные файлы.
- Хотите ли вы, чтобы я сразу настроил CI (создал `.github/workflows/ci.yml`) и запустил тесты? Это упростит дальнейшие проверки.

---

Если да — укажите, с чего начать: `1) audit → archive`, `2) сразу удалить`, `3) настроить CI` или `4) прогнать тесты`. Я выполню выбранный шаг и пришлю отчёт.

