# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Telegram –≥—Ä—É–ø–ø—ã –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤

## –ó–∞—á–µ–º –≥—Ä—É–ø–ø–∞?

- –í—Å–µ –∞–ª–µ—Ä—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –ù–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–∞–¥–º–∏–Ω—ã, devops) –≤–∏–¥—è—Ç –ø—Ä–æ–±–ª–µ–º—ã
- –ú–æ–∂–Ω–æ –æ–±—Å—É–∂–¥–∞—Ç—å –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ —Å –∞–ª–µ—Ä—Ç–∞–º–∏
- –†–∞–∑–Ω—ã–µ –±–æ—Ç—ã –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram ‚Üí –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
2. –ù–∞–∑–≤–∞–Ω–∏–µ: `Lectio Alerts` –∏–ª–∏ `Teaching Panel Monitoring`
3. –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ—Ö, –∫—Ç–æ –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –∞–ª–µ—Ä—Ç—ã

## –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø—É ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π ‚Üí –£—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Üí –î–æ–±–∞–≤–∏—Ç—å
2. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: `@LectioErrorsBot` (–≤–∞—à –±–æ—Ç –æ—à–∏–±–æ–∫)
3. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞
4. –î–∞–π—Ç–µ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

## –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID –≥—Ä—É–ø–ø—ã

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É, Chat ID –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ.

### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É

```bash
# –ù–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É, –∑–∞—Ç–µ–º:
curl "https://api.telegram.org/bot8227462251:AAH1H8k0F10chMkQPqglN_iNh3cJKMlnMHg/getUpdates" | jq
```

–ù–∞–π–¥–∏—Ç–µ `"chat": {"id": -1001234567890, ...}` - —ç—Ç–æ –∏ –µ—Å—Ç—å ID –≥—Ä—É–ø–ø—ã.

### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ Python

```python
import requests

TOKEN = "8227462251:AAH1H8k0F10chMkQPqglN_iNh3cJKMlnMHg"
url = f"https://api.telegram.org/bot{TOKEN}/getUpdates"
response = requests.get(url)
print(response.json())
# –ò—â–∏—Ç–µ chat.id —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º (–≥—Ä—É–ø–ø–∞)
```

## –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `/opt/lectio-monitor/config.env`:

```bash
# –ë—ã–ª–æ (–ª–∏—á–Ω—ã–π —á–∞—Ç):
ERRORS_CHAT_ID="6378715567"

# –°—Ç–∞–ª–æ (–≥—Ä—É–ø–ø–∞):
ERRORS_CHAT_ID="-1001234567890"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ID –≥—Ä—É–ø–ø—ã
```

–¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ –≤ Django `.env`:
```bash
ERRORS_CHAT_ID="-1001234567890"
```

## –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
curl -X POST "https://api.telegram.org/bot8227462251:AAH1H8k0F10chMkQPqglN_iNh3cJKMlnMHg/sendMessage" \
  -d "chat_id=-1001234567890" \
  -d "text=üß™ –¢–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç –∏–∑ –≥—Ä—É–ø–ø—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞" \
  -d "parse_mode=Markdown"
```

## –®–∞–≥ 6: –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–µ:

1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≥—Ä—É–ø–ø—É –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—É (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –¢–∏–ø –≥—Ä—É–ø–ø—ã)
2. –í–∫–ª—é—á–∏—Ç–µ —Ç–µ–º—ã (Topics)
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ–º—ã:
   - üî¥ Critical (site down)
   - üü° Warnings (slow response)
   - üîµ Info (deploys, backups)
   - üîê Security (attacks)

–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ç–µ–º—É –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `message_thread_id`:

```bash
curl -X POST "https://api.telegram.org/bot.../sendMessage" \
  -d "chat_id=-1001234567890" \
  -d "message_thread_id=123" \  # ID —Ç–µ–º—ã
  -d "text=–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–µ–º—É"
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤ - –≤—Å–µ–≥–¥–∞ –∑–≤—É–∫:
–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (Prioritized) –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö

### –î–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö - —Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º:
–ë–æ—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å `disable_notification=true`:

```python
send_telegram_alert(message, silent=True)  # –ë–µ–∑ –∑–≤—É–∫–∞
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É:

- `/status` - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `/mute 30m` - –∑–∞–≥–ª—É—à–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ 30 –º–∏–Ω—É—Ç
- `/checks` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ–π—á–∞—Å

–≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –±–æ—Ç–∞ (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞).

## –ì–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
#!/bin/bash
# update_chat_id.sh - –æ–±–Ω–æ–≤–ª—è–µ—Ç CHAT_ID –Ω–∞ –≥—Ä—É–ø–ø–æ–≤–æ–π

NEW_CHAT_ID="-1001234567890"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à

# –û–±–Ω–æ–≤–ª—è–µ–º config.env
ssh root@lectio.tw1.ru "sed -i 's/ERRORS_CHAT_ID=.*/ERRORS_CHAT_ID=\"${NEW_CHAT_ID}\"/' /opt/lectio-monitor/config.env"

# –¢–µ—Å—Ç–∏—Ä—É–µ–º
ssh root@lectio.tw1.ru "source /opt/lectio-monitor/config.env && curl -s -X POST 'https://api.telegram.org/bot\${ERRORS_BOT_TOKEN}/sendMessage' -d 'chat_id=${NEW_CHAT_ID}' -d 'text=‚úÖ –ì—Ä—É–ø–ø–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞!' | jq '.ok'"

echo "Done! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ."
```

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –≥—Ä—É–ø–ø—É

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Chat ID –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-100` –¥–ª—è —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø

### –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π

Telegram API –∏–Ω–æ–≥–¥–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–π. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤.

### –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. –£–≤–µ–ª–∏—á—å—Ç–µ ALERT_COOLDOWN –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö (—Å–µ–π—á–∞—Å 5 –º–∏–Ω—É—Ç)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `disable_notification=true` –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö
3. –û–±—ä–µ–¥–∏–Ω—è–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –≤ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
