# ๐ฅ ะะปะฐะฝ ัะตััะธัะพะฒะฐะฝะธั ะทะฐะฟััะบะฐ ััะพะบะพะฒ ะธ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะทะฐะฟะธัะธ

**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 2 ะดะตะบะฐะฑัั 2025  
**ะกัะฐััั:** ะะพัะพะฒะพ ะบ ัะตััะธัะพะฒะฐะฝะธั  
**ะัะธะพัะธัะตั:** ะัะธัะธัะตัะบะธะน (core ััะฝะบัะธะพะฝะฐะป)

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

1. [ะขะตะบััะตะต ัะพััะพัะฝะธะต ัะธััะตะผั](#ัะตะบััะตะต-ัะพััะพัะฝะธะต-ัะธััะตะผั)
2. [ะััะธัะตะบัััะฐ ะทะฐะฟััะบะฐ ััะพะบะฐ](#ะฐััะธัะตะบัััะฐ-ะทะฐะฟััะบะฐ-ััะพะบะฐ)
3. [ะะพะปะฝัะน ัะตัั-ะฟะปะฐะฝ ะทะฐะฟััะบะฐ ััะพะบะพะฒ](#ะฟะพะปะฝัะน-ัะตัั-ะฟะปะฐะฝ-ะทะฐะฟััะบะฐ-ััะพะบะพะฒ)
4. [ะขะตัั-ะฟะปะฐะฝ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะทะฐะฟะธัะธ](#ัะตัั-ะฟะปะฐะฝ-ะฐะฒัะพะผะฐัะธัะตัะบะพะน-ะทะฐะฟะธัะธ)
5. [ะฃะปัััะตะฝะธั ัะธััะตะผั ะทะฐะฟะธัะธ (TODO)](#ัะปัััะตะฝะธั-ัะธััะตะผั-ะทะฐะฟะธัะธ-todo)
6. [API Reference](#api-reference)
7. [ะะทะฒะตััะฝัะต ะฟัะพะฑะปะตะผั](#ะธะทะฒะตััะฝัะต-ะฟัะพะฑะปะตะผั)
8. [ะงะตะบ-ะปะธัั ะดะตะฟะปะพั](#ัะตะบ-ะปะธัั-ะดะตะฟะปะพั)

---

## ๐ ะขะตะบััะตะต ัะพััะพัะฝะธะต ัะธััะตะผั

### โ ะงัะพ ัะถะต ัะฐะฑะพัะฐะตั

**ะะฐะฟััะบ ััะพะบะฐ:**
- โ `POST /api/lessons/{id}/start/` โ ะพัะฝะพะฒะฝะพะน endpoint ะทะฐะฟััะบะฐ
- โ `POST /api/lessons/{id}/start-new/` โ ะทะฐะฟััะบ ั ัะตะปะธะทะพะผ ะฟัะตะดัะดััะตะน ะฒัััะตัะธ
- โ `POST /api/lessons/{id}/quick-start/` โ ะฑัััััะน ััะฐัั (ะธะท ัะฟะธัะบะฐ)
- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐัะฒะฐั Zoom ะฐะบะบะฐัะฝัะฐ ะธะท ะฟัะปะฐ (`ZoomAccount`)
- โ ะกะพะทะดะฐะฝะธะต Zoom ะฒัััะตัะธ ัะตัะตะท Server-to-Server OAuth
- โ ะกะพััะฐะฝะตะฝะธะต `zoom_meeting_id`, `zoom_start_url`, `zoom_join_url` ะฒ `Lesson`
- โ ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะดะพัััะฟะฐ (ัะพะปัะบะพ ะฒะปะฐะดะตะปะตั ััะพะบะฐ ะธะปะธ admin)
- โ ะัะพะฒะตัะบะฐ ะฐะบัะธะฒะฝะพะน ะฟะพะดะฟะธัะบะธ ััะธัะตะปั (`@require_active_subscription`)
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะดะตะนััะฒะธะน ะฒ `AuditLog`
- โ Webhook ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะตะปะธะทะฐ Zoom ะฐะบะบะฐัะฝัะฐ ะฟะพัะปะต ะพะบะพะฝัะฐะฝะธั ะฒัััะตัะธ

**ะะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐะฟะธัั:**
- โ ะะพะปะต `record_lesson` (BooleanField) ะฒ ะผะพะดะตะปะธ `Lesson` โ ัะตะบะฑะพะบั ะฟัะธ ัะพะทะดะฐะฝะธะธ
- โ Zoom ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟะธััะฒะฐะตั ะฒัััะตัั (ะตัะปะธ ะฒะบะปััะตะฝะพ ะฒ ะฝะฐัััะพะนะบะฐั ะฐะบะบะฐัะฝัะฐ)
- โ Webhook handler `/schedule/api/zoom/webhook/` ะดะปั `recording.completed`
- โ ะัะพะฒะตัะบะฐ `lesson.record_lesson` ะฟะตัะตะด ะพะฑัะฐะฑะพัะบะพะน
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต `LessonRecording` (status=processing)
- โ Celery task `process_zoom_recording()`:
  - ะกะบะฐัะธะฒะฐะฝะธะต ั Zoom Cloud
  - ะะฐะณััะทะบะฐ ะฒ Google Drive
  - ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ โ `ready`
  - ะัะพะฒะตัะบะฐ ะบะฒะพัั ััะฐะฝะตะฝะธั
  - ะฃััะฐะฝะพะฒะบะฐ `available_until` (ััะพะบ ะดะพัััะฟะฐ)
- โ ะัะพะฑัะฐะถะตะฝะธะต ะทะฐะฟะธัะตะน ะฒ ัะฐะทะดะตะปะต "๐น ะะฐะฟะธัะธ" (ััะธัะตะปั/ััะตะฝะธะบ)
- โ ะะฒัะพัะดะฐะปะตะฝะธะต ััะฐััั ะทะฐะฟะธัะตะน ัะตัะตะท `cleanup_old_recordings` task

### โ๏ธ ะงัะพ ััะตะฑัะตั ัะปัััะตะฝะธั

1. **UI ัะตะบะฑะพะบัะฐ ะทะฐะฟะธัะธ:**
   - โ ะงะตะบะฑะพะบั ัััะตััะฒัะตั ะฒ ะผะพะดะตะปะธ
   - โ **ะะ ะะขะะะะะะะะขะกะฏ** ะฒ ัะพัะผะต ัะพะทะดะฐะฝะธั ััะพะบะฐ ะฝะฐ ััะพะฝัะตะฝะดะต
   - โ ะะตั ะธะฝะดะธะบะฐัะพัะฐ "๐ด ะะะะะกะฌ" ะฟัะธ ััะฐััะต ััะพะบะฐ
   - โ ะะตะฟะพะฝััะฝะพ, ะธะดะตั ะปะธ ะทะฐะฟะธัั ะฒ ะดะฐะฝะฝัะน ะผะพะผะตะฝั

2. **ะะฒัะพะฝะฐัััะพะนะบะฐ Zoom:**
   - โ๏ธ ะัะถะฝะพ ะฒัััะฝัั ะฒะบะปััะธัั "ะะฒัะพะผะฐัะธัะตัะบัั ะทะฐะฟะธัั ะฒ ะพะฑะปะฐะบะพ" ะฒ ะบะฐะถะดะพะผ Zoom ะฐะบะบะฐัะฝัะต
   - โ๏ธ ะะตั API ะฟัะพะฒะตัะบะธ, ััะพ ะทะฐะฟะธัั ะดะตะนััะฒะธัะตะปัะฝะพ ะฝะฐัะฐะปะฐัั

3. **ะฃะฒะตะดะพะผะปะตะฝะธั:**
   - โ ะะตั ัะฒะตะดะพะผะปะตะฝะธั ััะธัะตะปั, ะบะพะณะดะฐ ะทะฐะฟะธัั ะณะพัะพะฒะฐ
   - โ ะะตั ัะฒะตะดะพะผะปะตะฝะธั ััะตะฝะธะบะฐะผ ะพ ะฝะพะฒะพะน ะดะพัััะฟะฝะพะน ะทะฐะฟะธัะธ

4. **ะัะตะฒัั ะธ ะฝะฐะทะฒะฐะฝะธั:**
   - โ๏ธ ะะฐะฟะธัั ะฟะพะปััะฐะตั ะฝะฐะทะฒะฐะฝะธะต ะธะท `lesson.title` ัะตัะตะท webhook
   - โ๏ธ ะะตั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะณะตะฝะตัะฐัะธะธ ะฟัะตะฒัั/thumbnail
   - โ๏ธ ะะตะปัะทั ะฟะตัะตะธะผะตะฝะพะฒะฐัั ะทะฐะฟะธัั ะฟะพัะปะต ะทะฐะณััะทะบะธ

### ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะพะปะณะธ

- ๐ ะะตั unit-ัะตััะพะฒ ะดะปั `process_zoom_recording` task
- ๐ ะััััััะฒัะตั ะผะพะฝะธัะพัะธะฝะณ ัะฑะพะตะฒ ะทะฐะฟะธัะธ (ะตัะปะธ Zoom ะฝะต ะพัะฟัะฐะฒะธะป webhook)
- ๐ ะะตั ัััะฝะพะน ะบะฝะพะฟะบะธ "ะัะธะฝัะดะธัะตะปัะฝะพ ัะธะฝััะพะฝะธะทะธัะพะฒะฐัั ะทะฐะฟะธัะธ"
- ๐ ะะต ะฝะฐัััะพะตะฝ Zoom Webhook (ัะผ. `ZOOM_WEBHOOK_SETUP.md`)
- ๐ ะะตั ะปะพะณะธัะพะฒะฐะฝะธั ะฒัะตะผะตะฝะธ ะพะฑัะฐะฑะพัะบะธ (ัะบะฐัะธะฒะฐะฝะธะต + ะทะฐะณััะทะบะฐ)

---

## ๐๏ธ ะััะธัะตะบัััะฐ ะทะฐะฟััะบะฐ ััะพะบะฐ

### ะกัะตะผะฐ ะฟะพัะพะบะฐ ะดะฐะฝะฝัั (ะทะฐะฟััะบ ััะพะบะฐ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        ะฃะงะะขะะะฌ ะฝะฐะถะธะผะฐะตั "ะะฐัะฐัั ััะพะบ"                   โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 1. POST /api/lessons/{id}/start/
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  LessonViewSet.start()                                  โ
โ  โข ะัะพะฒะตัะบะฐ ะฟัะฐะฒ (is_owner or admin)                   โ
โ  โข ะัะพะฒะตัะบะฐ ะฟะพะดะฟะธัะบะธ (@require_active_subscription)    โ
โ  โข ะะฐัะฒะฐั ัะฒะพะฑะพะดะฝะพะณะพ Zoom ะฐะบะบะฐัะฝัะฐ (atomic)            โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 2. ะกะพะทะดะฐะฝะธะต Zoom ะฒัััะตัะธ
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  zoom_service.create_zoom_meeting()                     โ
โ  โข topic = f"{group.name} - {lesson.title}"            โ
โ  โข start_time = lesson.start_time                      โ
โ  โข duration = lesson.duration_minutes                  โ
โ  โข settings.auto_recording = "cloud" (ะตัะปะธ enabled)   โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 3. ะกะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ะฒัััะตัะธ
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  lesson.zoom_meeting_id = meeting_data['id']            โ
โ  lesson.zoom_start_url = meeting_data['start_url']     โ
โ  lesson.zoom_join_url = meeting_data['join_url']       โ
โ  lesson.zoom_password = meeting_data['password']       โ
โ  lesson.zoom_account_used = zoom_account               โ
โ  lesson.save()                                          โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 4. ะะพะทะฒัะฐั ัััะปะพะบ
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Response 200:                                          โ
โ  {                                                      โ
โ    "zoom_start_url": "https://zoom.us/s/...",         โ
โ    "zoom_join_url": "https://zoom.us/j/...",          โ
โ    "zoom_meeting_id": "82345678901",                   โ
โ    "zoom_password": "abc123"                           โ
โ  }                                                      โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 5. ะฃัะธัะตะปั ะฟะตัะตัะพะดะธั ะฝะฐ zoom_start_url
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฅ ZOOM ะะกะขะะะงะ ะะะงะะะะะขะกะฏ                            โ
โ  โข ะัะปะธ lesson.record_lesson = True โ ะทะฐะฟะธัั ััะฐัััะตั โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะกัะตะผะฐ ะฟะพัะพะบะฐ ะดะฐะฝะฝัั (ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐะฟะธัั)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฅ ZOOM ะะกะขะะะงะ ะะะะะะจะะะขะกะฏ                           โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 1. Zoom ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟะธัั (~5-10 ะผะธะฝ)
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  POST /schedule/api/zoom/webhook/                       โ
โ  {                                                      โ
โ    "event": "recording.completed",                     โ
โ    "payload": {                                        โ
โ      "object": {                                       โ
โ        "id": "82345678901",  // zoom_meeting_id       โ
โ        "recording_files": [...]                       โ
โ      }                                                 โ
โ    }                                                   โ
โ  }                                                      โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 2. webhooks.py ะฟัะพะฒะตััะตั HMAC ะฟะพะดะฟะธัั
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  webhooks.handle_recording_completed()                  โ
โ  โข ะะฐัะพะดะธั ััะพะบ ะฟะพ zoom_meeting_id                     โ
โ  โข ะัะพะฒะตััะตั lesson.record_lesson == True              โ
โ  โข ะกะพะทะดะฐะตั LessonRecording (status=processing)         โ
โ  โข ะะฐะฟััะบะฐะตั Celery: process_zoom_recording.delay()   โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 3. ะคะพะฝะพะฒะฐั ะพะฑัะฐะฑะพัะบะฐ (Celery)
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  tasks.process_zoom_recording(recording_id)             โ
โ  โโ 1. ะกะบะฐัะฐัั ั Zoom Cloud (download_url)            โ
โ  โโ 2. ะกะถะฐัะธะต ัะตัะตะท FFmpeg (ะพะฟัะธะพะฝะฐะปัะฝะพ)              โ
โ  โโ 3. ะะฐะณััะทะธัั ะฒ Google Drive (gdrive_utils)        โ
โ  โโ 4. ะะฑะฝะพะฒะธัั LessonRecording:                      โ
โ  โ    โข gdrive_file_id                                โ
โ  โ    โข play_url (embed link)                         โ
โ  โ    โข status = 'ready'                              โ
โ  โ    โข available_until = now + 90 days               โ
โ  โโ 5. ะะฑะฝะพะฒะธัั ะบะฒะพัั ััะธัะตะปั (used_storage_gb)      โ
โ  โโ 6. ะฃะดะฐะปะธัั ะฒัะตะผะตะฝะฝัะน ัะฐะนะป                         โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ 4. ะะฐะฟะธัั ะดะพัััะฟะฝะฐ
                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐น ะะะะะะ "ะะะะะกะ"                                    โ
โ  โข ะฃัะธัะตะปั ะฒะธะดะธั ะทะฐะฟะธัั ะฒ /teacher/recordings         โ
โ  โข ะฃัะตะฝะธะบะธ ะฒะธะดัั ะทะฐะฟะธัั ะฒ /student/recordings         โ
โ  โข ะะฐะทะฒะฐะฝะธะต = lesson.title                            โ
โ  โข ะะฐัะฐ = lesson.start_time                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพะปะฝัะน ัะตัั-ะฟะปะฐะฝ ะทะฐะฟััะบะฐ ััะพะบะพะฒ

### ะะฐะทะดะตะป 1: ะกะพะทะดะฐะฝะธะต ััะพะบะฐ ั ะทะฐะฟะธััั

#### ะขะตัั 1.1: ะกะพะทะดะฐะฝะธะต ััะพะบะฐ ั ัะตะบะฑะพะบัะพะผ "ะะฐะฟะธััะฒะฐัั ััะพะบ"

**ะัะตะดััะปะพะฒะธั:**
- ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะปะพะณะธะฝะตะฝ ะบะฐะบ ััะธัะตะปั
- ะะตัะตัะตะป ะฝะฐ ัััะฐะฝะธัั ัะพะทะดะฐะฝะธั ััะพะบะฐ

**ะจะฐะณะธ:**
1. ะะฐะฟะพะปะฝะธัั ัะพัะผั ััะพะบะฐ:
   - ะััะฟะฟะฐ: "ะะฐัะตะผะฐัะธะบะฐ 9ะ"
   - ะะฐะทะฒะฐะฝะธะต: "ะขะตะพัะตะผะฐ ะะธัะฐะณะพัะฐ"
   - ะะฐัะฐ: 5 ะดะตะบะฐะฑัั 2025, 14:00
   - ะะปะธัะตะปัะฝะพััั: 60 ะผะธะฝัั
2. โ **ะะะะขะ ะงะะะะะะก "๐น ะะฐะฟะธััะฒะฐัั ััะพะบ"**
3. โ **ะะะกะขะะะะขะฌ ะะะะะงะะฃ**
4. ะะฐะถะฐัั "ะกะพะทะดะฐัั ััะพะบ"

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะฃัะพะบ ัะพะทะดะฐะฝ
- โ ะ ะะ: `lesson.record_lesson = True`
- โ ะัะธ ะพัะบัััะธะธ ััะพะบะฐ ัะตะบะฑะพะบั ะฐะบัะธะฒะตะฝ (ะผะพะถะฝะพ ะธะทะผะตะฝะธัั ะดะพ ััะฐััะฐ)

**ะัะพะฒะตัะบะฐ ะฒ ะะ:**
```sql
SELECT id, title, record_lesson, recording_available_for_days 
FROM schedule_lesson 
WHERE title = 'ะขะตะพัะตะผะฐ ะะธัะฐะณะพัะฐ';

-- record_lesson ะดะพะปะถะตะฝ ะฑััั True
```

**โ๏ธ ะขะะะฃะฉะะฏ ะะะะะะะะ:**
ะงะตะบะฑะพะบั ะะ ะพัะพะฑัะฐะถะฐะตััั ะฒ ัะพัะผะต ัะพะทะดะฐะฝะธั ััะพะบะฐ ะฝะฐ ััะพะฝัะตะฝะดะต!

**๐ง ะขะะะะฃะะขะกะฏ ะะกะะะะะะะะะ:**
ะะพะฑะฐะฒะธัั ัะตะบะฑะพะบั ะฒ ัะพัะผั ัะพะทะดะฐะฝะธั/ัะตะดะฐะบัะธัะพะฒะฐะฝะธั ััะพะบะฐ.

#### ะขะตัั 1.2: ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฝะฐัััะพะนะบะธ ะทะฐะฟะธัะธ

**ะจะฐะณะธ:**
1. ะัะบัััั ัััะตััะฒัััะธะน ััะพะบ (ะบะพัะพััะน ะตัะต ะฝะต ะฝะฐัะฐะปัั)
2. ะะทะผะตะฝะธัั ัะตะบะฑะพะบั "ะะฐะฟะธััะฒะฐัั ััะพะบ" ั `True` ะฝะฐ `False`
3. ะกะพััะฐะฝะธัั ะธะทะผะตะฝะตะฝะธั

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะฐัััะพะนะบะฐ ะพะฑะฝะพะฒะปะตะฝะฐ ะฒ ะะ
- โ ะัะธ ะทะฐะฟััะบะต ััะพะบะฐ ะทะฐะฟะธัั ะะ ะฑัะดะตั ัะพะทะดะฐะฒะฐัััั

#### ะขะตัั 1.3: ะะพะฟััะบะฐ ะธะทะผะตะฝะธัั ะฝะฐัััะพะนะบั ะฟะพัะปะต ััะฐััะฐ ััะพะบะฐ

**ะจะฐะณะธ:**
1. ะะฐะฟัััะธัั ััะพะบ (ัะพะทะดะฐัั Zoom ะฒัััะตัั)
2. ะะพะฟััะฐัััั ะธะทะผะตะฝะธัั ัะตะบะฑะพะบั "ะะฐะฟะธััะฒะฐัั ััะพะบ"

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ๏ธ **ะขะะะฃะฉะะ ะะะะะะะะะ:** ะะพะถะฝะพ ะธะทะผะตะฝะธัั (ะฝะพ ัะถะต ะฟะพะทะดะฝะพ)
- ๐ **ะะะะะะะะ:** ะงะตะบะฑะพะบั ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ ะฟะพัะปะต ััะฐััะฐ ััะพะบะฐ
- ๐ ะะพะบะฐะทะฐัั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต: "ะะตะปัะทั ะธะทะผะตะฝะธัั ะฟะพัะปะต ะทะฐะฟััะบะฐ ะฒัััะตัะธ"

---

### ะะฐะทะดะตะป 2: ะะฐะฟััะบ ััะพะบะฐ (ะพัะฝะพะฒะฝะพะน flow)

#### ะขะตัั 2.1: ะฃัะฟะตัะฝัะน ะทะฐะฟััะบ ััะพะบะฐ ะฒ ะฟะตัะฒัะน ัะฐะท

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ัะพะทะดะฐะฝ, ะตัะต ะฝะต ะทะฐะฟััะตะฝ
- ะฃัะธัะตะปั ะธะผะตะตั ะฐะบัะธะฒะฝัั ะฟะพะดะฟะธัะบั
- ะ ะฟัะปะต ะตััั ัะฒะพะฑะพะดะฝัะต Zoom ะฐะบะบะฐัะฝัั

**ะจะฐะณะธ:**
1. ะะตัะตะนัะธ ะฝะฐ ัััะฐะฝะธัั ััะพะบะฐ
2. ะะฐะถะฐัั "โถ๏ธ ะะฐัะฐัั ััะพะบ"

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะฐะฟัะพั: `POST /api/lessons/{id}/start/`
- โ Response 200:
  ```json
  {
    "zoom_start_url": "https://zoom.us/s/82345678901?zak=...",
    "zoom_join_url": "https://zoom.us/j/82345678901?pwd=...",
    "zoom_meeting_id": "82345678901",
    "zoom_password": "abc123"
  }
  ```
- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตะดะธัะตะบั ะฝะฐ `zoom_start_url`
- โ ะ ะะ: `lesson.zoom_meeting_id` ะทะฐะฟะพะปะฝะตะฝ
- โ Zoom ะฐะบะบะฐัะฝั ะทะฐะฝัั (`zoom_account.is_busy = True`)

**ะัะพะฒะตัะบะฐ ะฒ ะะ:**
```sql
SELECT id, zoom_meeting_id, zoom_account_used_id 
FROM schedule_lesson 
WHERE id = <lesson_id>;

-- zoom_meeting_id ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟะพะปะฝะตะฝ
-- zoom_account_used_id ะดะพะปะถะตะฝ ัะบะฐะทัะฒะฐัั ะฝะฐ ZoomAccount

SELECT id, name, is_busy, current_lesson_id 
FROM zoom_pool_zoomaccount 
WHERE id = <zoom_account_id>;

-- is_busy = True
-- current_lesson_id = <lesson_id>
```

#### ะขะตัั 2.2: ะะฐะฟััะบ ััะพะบะฐ ั ะธะฝะดะธะบะฐัะพัะพะผ ะทะฐะฟะธัะธ

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ั `record_lesson = True`

**ะจะฐะณะธ:**
1. ะะฐะถะฐัั "โถ๏ธ ะะฐัะฐัั ััะพะบ"
2. **ะะะะะะะะขะฌ ะะะะะะะขะะ ะะะะะกะ**

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะัะดะพะผ ั ะบะฝะพะฟะบะพะน "ะะฐัะฐัั ััะพะบ" ะฟะพัะฒะปัะตััั ะธะบะพะฝะบะฐ: **"๐ด ะะะะะกะฌ"**
- โ ะฆะฒะตั ะธะบะพะฝะบะธ: ะบัะฐัะฝัะน (#ef4444)
- โ Tooltip: "ะฃัะพะบ ะฑัะดะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟะธัะฐะฝ"
- โ ะัะธ ะทะฐะฟััะบะต Zoom ะฒัััะตัะธ ะฒะบะปััะฐะตััั ะทะฐะฟะธัั ะฒ ะพะฑะปะฐะบะพ

**โ๏ธ ะขะะะฃะฉะะฏ ะะะะะะะะ:**
ะะฝะดะธะบะฐัะพั ะะ ะพัะพะฑัะฐะถะฐะตััั!

**๐ง ะขะะะะฃะะขะกะฏ ะะกะะะะะะะะะ:**
```javascript
// ะ LessonCard.js ะธะปะธ LessonDetail.js
{lesson.record_lesson && (
  <div className="recording-indicator" title="ะฃัะพะบ ะฑัะดะตั ะทะฐะฟะธัะฐะฝ">
    <span className="recording-icon">๐ด</span>
    <span className="recording-label">ะะะะะกะฌ</span>
  </div>
)}
```

#### ะขะตัั 2.3: ะะพะฒัะพัะฝัะน ะทะฐะฟััะบ ััะพะบะฐ (ััะฐัั ะฝะพะฒะพะน ะฒัััะตัะธ)

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ัะถะต ะทะฐะฟััะบะฐะปัั ัะฐะฝะตะต (`zoom_meeting_id` ะทะฐะฟะพะปะฝะตะฝ)
- ะัััะตัะฐ ะทะฐะฒะตััะตะฝะฐ (Zoom ะฐะบะบะฐัะฝั ะพัะฒะพะฑะพะถะดะตะฝ)

**ะจะฐะณะธ:**
1. ะะฐะถะฐัั "โถ๏ธ ะะฐัะฐัั ััะพะบ" ะฟะพะฒัะพัะฝะพ

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ๏ธ **ะะะะะะะข 1:** ะัะธะฑะบะฐ "ะัััะตัะฐ ัะถะต ัะพะทะดะฐะฝะฐ, ะธัะฟะพะปัะทัะนัะต ัััะปะบั"
- โ **ะะะะะะะข 2:** ะัะฟะพะปัะทัะตััั `POST /api/lessons/{id}/start-new/` โ ัะพะทะดะฐะตััั ะฝะพะฒะฐั ะฒัััะตัะฐ, ััะฐัะฐั ัะดะฐะปัะตััั

**ะะตะบะพะผะตะฝะดะฐัะธั:**
ะะพะบะฐะทะฐัั ะดะธะฐะปะพะณ ะฒัะฑะพัะฐ:
```
ะัััะตัะฐ ัะถะต ัะพะทะดะฐะฝะฐ ัะฐะฝะตะต.

[ะัะฟะพะปัะทะพะฒะฐัั ััะฐััั ัััะปะบั]  [ะกะพะทะดะฐัั ะฝะพะฒัั ะฒัััะตัั]
```

#### ะขะตัั 2.4: ะะฐะฟััะบ ะฑะตะท ัะฒะพะฑะพะดะฝัั Zoom ะฐะบะบะฐัะฝัะพะฒ

**ะัะตะดััะปะพะฒะธั:**
- ะัะต Zoom ะฐะบะบะฐัะฝัั ะทะฐะฝััั (`is_busy = True`)

**ะจะฐะณะธ:**
1. ะะพะฟััะฐัััั ะทะฐะฟัััะธัั ััะพะบ

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะัะธะฑะบะฐ 503: "ะะตั ัะฒะพะฑะพะดะฝัั Zoom ะฐะบะบะฐัะฝัะพะฒ"
- โ ะกะพะพะฑัะตะฝะธะต: "ะัะต Zoom ะฐะบะบะฐัะฝัั ะทะฐะฝััั. ะะพะฟัะพะฑัะนัะต ัะตัะตะท ะฝะตัะบะพะปัะบะพ ะผะธะฝัั."
- โ ะะพะบะฐะทะฐัั ัะฟะธัะพะบ ะทะฐะฝัััั ะฐะบะบะฐัะฝัะพะฒ (ะดะปั ะฐะดะผะธะฝะฐ)

#### ะขะตัั 2.5: ะะฐะฟััะบ ั ะธััะตะบัะตะน ะฟะพะดะฟะธัะบะพะน

**ะัะตะดััะปะพะฒะธั:**
- ะะพะดะฟะธัะบะฐ ััะธัะตะปั ะธััะตะบะปะฐ (`subscription.status = 'expired'`)

**ะจะฐะณะธ:**
1. ะะพะฟััะฐัััั ะทะฐะฟัััะธัั ััะพะบ

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะัะธะฑะบะฐ 403: "ะะพะดะฟะธัะบะฐ ะธััะตะบะปะฐ"
- โ ะกะพะพะฑัะตะฝะธะต: "ะะปั ะทะฐะฟััะบะฐ ััะพะบะพะฒ ััะตะฑัะตััั ะฐะบัะธะฒะฝะฐั ะฟะพะดะฟะธัะบะฐ"
- โ ะะฝะพะฟะบะฐ "ะะฟะปะฐัะธัั ะฟะพะดะฟะธัะบั"

#### ะขะตัั 2.6: ะะพะฟััะบะฐ ะทะฐะฟััะบะฐ ััะถะพะณะพ ััะพะบะฐ

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะธัะตะปั A ะฟััะฐะตััั ะทะฐะฟัััะธัั ััะพะบ ััะธัะตะปั B

**ะจะฐะณะธ:**
1. ะะพะปััะธัั ID ััะถะพะณะพ ััะพะบะฐ
2. ะัะฟัะฐะฒะธัั `POST /api/lessons/{id}/start/`

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะัะธะฑะบะฐ 403: "ะะพัััะฟ ะทะฐะฟัะตัะตะฝ"
- โ ะขะพะปัะบะพ ะฒะปะฐะดะตะปะตั ััะพะบะฐ ะธะปะธ ะฐะดะผะธะฝ ะผะพะณัั ะทะฐะฟััะบะฐัั

---

### ะะฐะทะดะตะป 3: ะะฐะฒะตััะตะฝะธะต ััะพะบะฐ ะธ ัะตะปะธะท Zoom ะฐะบะบะฐัะฝัะฐ

#### ะขะตัั 3.1: ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตะปะธะท ัะตัะตะท webhook

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ะทะฐะฟััะตะฝ, ะฒัััะตัะฐ ะทะฐะฒะตััะตะฝะฐ ะฒ Zoom

**ะจะฐะณะธ:**
1. ะฃัะธัะตะปั ะทะฐะฒะตััะฐะตั ะฒัััะตัั ะฒ Zoom
2. Zoom ะพัะฟัะฐะฒะปัะตั webhook: `meeting.ended`

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ Endpoint: `POST /schedule/webhook/zoom/`
- โ Zoom ะฐะบะบะฐัะฝั ะพัะฒะพะฑะพะถะดะฐะตััั:
  - `zoom_account.is_busy = False`
  - `zoom_account.current_lesson = None`
- โ ะะพะณ: "Zoom ะฐะบะบะฐัะฝั ะพัะฒะพะฑะพะถะดะตะฝ ะฟะพัะปะต ะฒัััะตัะธ"

**ะัะพะฒะตัะบะฐ ะฒ ะะ:**
```sql
SELECT id, name, is_busy, current_lesson_id 
FROM zoom_pool_zoomaccount 
WHERE id = <zoom_account_id>;

-- is_busy = False
-- current_lesson_id = NULL
```

#### ะขะตัั 3.2: ะััะฝะพะน ัะตะปะธะท ัะตัะตะท ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั

**ะัะตะดััะปะพะฒะธั:**
- Webhook ะฝะต ััะฐะฑะพัะฐะป (ัะตัะตะฒะฐั ะพัะธะฑะบะฐ)
- Zoom ะฐะบะบะฐัะฝั "ะทะฐะฒะธั" (`is_busy = True`)

**ะจะฐะณะธ:**
1. ะะดะผะธะฝ ะพัะบััะฒะฐะตั ZoomPoolManager
2. ะะฐัะพะดะธั "ะทะฐะฒะธััะธะน" ะฐะบะบะฐัะฝั
3. ะะฐะถะธะผะฐะตั "๐ ะัะฒะพะฑะพะดะธัั ะฒัััะฝัั"

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ `POST /api/zoom-accounts/{id}/release/`
- โ ะะบะบะฐัะฝั ะพัะฒะพะฑะพะถะดะตะฝ
- โ ะฃะฒะตะดะพะผะปะตะฝะธะต: "ะะบะบะฐัะฝั ััะฟะตัะฝะพ ะพัะฒะพะฑะพะถะดะตะฝ"

#### ะขะตัั 3.3: ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตะปะธะท ัะตัะตะท Celery task

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ะทะฐะฒะตััะธะปัั 2 ัะฐัะฐ ะฝะฐะทะฐะด
- Zoom ะฐะบะบะฐัะฝั ะฒัะต ะตัะต ะทะฐะฝัั (webhook ะฝะต ััะฐะฑะพัะฐะป)

**ะจะฐะณะธ:**
1. ะะฐะฟััะบะฐะตััั Celery task: `release_finished_zoom_accounts`
2. ะัะพะฒะตัััััั ััะพะบะธ, ะณะดะต `end_time < now - 1 hour`

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะบะบะฐัะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะฒะพะฑะพะถะดะฐะตััั
- โ ะะพะณ: "Auto-released stuck Zoom account"

**ะะฐะฟััะบ ัะตััะฐ ะฒัััะฝัั:**
```bash
cd teaching_panel
python manage.py shell -c "from schedule.tasks import release_finished_zoom_accounts; release_finished_zoom_accounts()"
```

---

## ๐ ะขะตัั-ะฟะปะฐะฝ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะทะฐะฟะธัะธ

### ะะฐะทะดะตะป 4: ะกะพะทะดะฐะฝะธะต ะธ ะพะฑัะฐะฑะพัะบะฐ ะทะฐะฟะธัะธ

#### ะขะตัั 4.1: ะะฐะฟะธัั ััะพะบะฐ ั ัะตะบะฑะพะบัะพะผ (end-to-end)

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ัะพะทะดะฐะฝ ั `record_lesson = True`
- Zoom Webhook ะฝะฐัััะพะตะฝ (ัะผ. `ZOOM_WEBHOOK_SETUP.md`)
- Celery worker ะทะฐะฟััะตะฝ

**ะจะฐะณะธ:**
1. ะะฐะฟัััะธัั ััะพะบ
2. ะัะพะฒะตััะธ ะฒัััะตัั ะฒ Zoom (ะผะธะฝะธะผัะผ 1 ะผะธะฝััะฐ)
3. ะะฐะฒะตััะธัั ะฒัััะตัั
4. ะะพะดะพะถะดะฐัั ~5-10 ะผะธะฝัั (Zoom ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟะธัั)

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ Zoom ะพัะฟัะฐะฒะปัะตั webhook: `recording.completed`
- โ ะกะพะทะดะฐะตััั `LessonRecording` (status=processing)
- โ Celery task `process_zoom_recording` ะฒัะฟะพะปะฝัะตััั:
  - ะกะบะฐัะธะฒะฐะตั MP4 ั Zoom (~100-500 MB)
  - ะะฐะณััะถะฐะตั ะฒ Google Drive
  - ะกัะฐััั โ `ready`
- โ ะะฐะฟะธัั ะฟะพัะฒะปัะตััั ะฒ ัะฐะทะดะตะปะต "๐น ะะฐะฟะธัะธ"
- โ ะะฐะทะฒะฐะฝะธะต ะทะฐะฟะธัะธ = `lesson.title`

**ะัะพะฒะตัะบะฐ ะฒ ะะ:**
```sql
SELECT id, lesson_id, status, gdrive_file_id, file_size, available_until
FROM schedule_lessonrecording
WHERE lesson_id = <lesson_id>;

-- status = 'ready'
-- gdrive_file_id ะทะฐะฟะพะปะฝะตะฝ
-- file_size > 0
```

**ะัะพะฒะตัะบะฐ ะฒ Google Drive:**
```bash
# ะงะตัะตะท API ะธะปะธ ะฒะตะฑ-ะธะฝัะตััะตะนั Drive
# ะคะฐะนะป ะดะพะปะถะตะฝ ัััะตััะฒะพะฒะฐัั ั ID = gdrive_file_id
```

#### ะขะตัั 4.2: ะฃัะพะบ ะะะ ะทะฐะฟะธัะธ (ัะตะบะฑะพะบั ะฒัะบะปััะตะฝ)

**ะัะตะดััะปะพะฒะธั:**
- ะฃัะพะบ ัะพะทะดะฐะฝ ั `record_lesson = False`

**ะจะฐะณะธ:**
1. ะะฐะฟัััะธัั ััะพะบ
2. ะะฐะฒะตััะธัั ะฒัััะตัั
3. ะะพะดะพะถะดะฐัั webhook

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ Zoom ะพัะฟัะฐะฒะปัะตั webhook: `recording.completed`
- โ Webhook handler ะฟัะพะฒะตััะตั `lesson.record_lesson`
- โ Response 200: `{"status": "recording_disabled"}`
- โ `LessonRecording` ะะ ัะพะทะดะฐะตััั
- โ ะะฐะฟะธัั ะะ ัะบะฐัะธะฒะฐะตััั ั Zoom

**ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ:**
```bash
sudo tail -f /var/log/teaching_panel/django.log | grep "Recording disabled"
```

#### ะขะตัั 4.3: ะะฑัะฐะฑะพัะบะฐ ะฝะตัะบะพะปัะบะธั ัะฐะนะปะพะฒ ะทะฐะฟะธัะธ

**ะกัะตะฝะฐัะธะน:**
Zoom ัะพะทะดะฐะตั ะฝะตัะบะพะปัะบะพ ัะฐะนะปะพะฒ ะดะปั ะพะดะฝะพะน ะฒัััะตัะธ:
- `shared_screen_with_speaker_view.mp4` (ะพัะฝะพะฒะฝะพะน ะฒะธะดะตะพ)
- `audio_only.m4a` (ะฐัะดะธะพ ะดะพัะพะถะบะฐ)
- `chat_file.txt` (ัะฐั, ะธะณะฝะพัะธััะตััั)

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะฑัะฐะฑะฐััะฒะฐัััั ัะพะปัะบะพ `mp4` ะธ `m4a`
- โ ะกะพะทะดะฐัััั 2 `LessonRecording` ะพะฑัะตะบัะฐ
- โ ะะฑะฐ ะทะฐะณััะถะฐัััั ะฒ Google Drive

#### ะขะตัั 4.4: ะกะฑะพะน ะทะฐะณััะทะบะธ ะฝะฐ Google Drive

**ะกัะตะฝะฐัะธะน:**
- ะะฒะพัะฐ Google Drive ะธััะตัะฟะฐะฝะฐ
- ะะปะธ ัะตัะตะฒะฐั ะพัะธะฑะบะฐ ะฟัะธ ะทะฐะณััะทะบะต

**ะจะฐะณะธ:**
1. ะะฐะฟัััะธัั ััะพะบ ั ะทะฐะฟะธััั
2. ะะผะธัะธัะพะฒะฐัั ัะฑะพะน Drive (ะพัะบะปััะธัั ะธะฝัะตัะฝะตั ะฝะฐ ัะตัะฒะตัะต)

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ Celery task ะทะฐะฒะตััะฐะตััั ั ะพัะธะฑะบะพะน
- โ ะกัะฐััั ะทะฐะฟะธัะธ: `status = 'failed'`
- โ ะะฐะฟะธัั ะพััะฐะตััั ะฝะฐ Zoom (ะฝะต ัะดะฐะปัะตััั)
- โ ะะพะถะฝะพ ะฟะพะฒัะพัะธัั ะฟะพะฟััะบั ะฒัััะฝัั

#### ะขะตัั 4.5: ะัะตะฒััะตะฝะธะต ะบะฒะพัั ััะธัะตะปั

**ะัะตะดััะปะพะฒะธั:**
- ะะฒะพัะฐ ััะธัะตะปั: 5 GB
- ะัะฟะพะปัะทะพะฒะฐะฝะพ: 4.8 GB
- ะะฐะทะผะตั ะฝะพะฒะพะน ะทะฐะฟะธัะธ: 500 MB (ะฟัะตะฒััะธั ะปะธะผะธั)

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ Celery task ะฟัะตััะฒะฐะตััั ั ะพัะธะฑะบะพะน: "Quota exceeded"
- โ ะกัะฐััั ะทะฐะฟะธัะธ: `status = 'failed'`
- โ ะฃัะธัะตะปั ะฟะพะปััะฐะตั ัะฒะตะดะพะผะปะตะฝะธะต (email/Telegram)
- โ ะัะตะดะปะพะถะตะฝะธะต: "ะฃะฒะตะปะธัะธัั ะบะฒะพัั" ะธะปะธ "ะฃะดะฐะปะธัั ััะฐััะต ะทะฐะฟะธัะธ"

---

### ะะฐะทะดะตะป 5: ะะพัััะฟ ะบ ะทะฐะฟะธััะผ

#### ะขะตัั 5.1: ะฃัะธัะตะปั ะฟัะพัะผะฐััะธะฒะฐะตั ัะฒะพะธ ะทะฐะฟะธัะธ

**ะจะฐะณะธ:**
1. ะะตัะตะนัะธ ะฝะฐ `/teacher/recordings`
2. ะะฐะนัะธ ะทะฐะฟะธัั ััะพะบะฐ "ะขะตะพัะตะผะฐ ะะธัะฐะณะพัะฐ"
3. ะะฐะถะฐัั "โถ๏ธ ะะพัะฟัะพะธะทะฒะตััะธ"

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะฐะฟัะพั: `GET /api/recordings/teacher/`
- โ ะกะฟะธัะพะบ ะฒัะตั ะทะฐะฟะธัะตะน ััะธัะตะปั
- โ ะัะธ ะบะปะธะบะต ะพัะบััะฒะฐะตััั Google Drive embed player
- โ ะะธะดะตะพ ะฒะพัะฟัะพะธะทะฒะพะดะธััั ะฒ iframe

#### ะขะตัั 5.2: ะฃัะตะฝะธะบ ะฟัะพัะผะฐััะธะฒะฐะตั ะทะฐะฟะธัะธ ัะฒะพะตะน ะณััะฟะฟั

**ะจะฐะณะธ:**
1. ะะฐะปะพะณะธะฝะธัััั ะบะฐะบ ััะตะฝะธะบ ะณััะฟะฟั "ะะฐัะตะผะฐัะธะบะฐ 9ะ"
2. ะะตัะตะนัะธ ะฝะฐ `/student/recordings`
3. ะะฐะนัะธ ะทะฐะฟะธัั ััะพะบะฐ "ะขะตะพัะตะผะฐ ะะธัะฐะณะพัะฐ"

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะฐะฟัะพั: `GET /api/recordings/`
- โ ะะธะดะฝั ัะพะปัะบะพ ะทะฐะฟะธัะธ ะณััะฟะฟ, ะณะดะต ัััะดะตะฝั ัะพััะพะธั
- โ ะะฐะฟะธัั ะดะพัััะฟะฝะฐ, ะตัะปะธ `available_until > now`
- โ ะะพะถะตั ะฒะพัะฟัะพะธะทะฒะพะดะธัั ะทะฐะฟะธัั

#### ะขะตัั 5.3: ะะพะฟััะบะฐ ะดะพัััะฟะฐ ะบ ััะถะพะน ะทะฐะฟะธัะธ

**ะจะฐะณะธ:**
1. ะฃัะตะฝะธะบ ะณััะฟะฟั "ะะฝะณะปะธะนัะบะธะน A1" ะฟััะฐะตััั ะพัะบัััั ะทะฐะฟะธัั ะณััะฟะฟั "ะะฐัะตะผะฐัะธะบะฐ 9ะ"
2. ะะพะดะดะตะปัะฒะฐะตั ะทะฐะฟัะพั: `GET /api/recordings/{id}/`

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะัะธะฑะบะฐ 403: "ะะพัััะฟ ะทะฐะฟัะตัะตะฝ"
- โ ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะฒ `recording_detail()` view

#### ะขะตัั 5.4: ะะฐะฟะธัั ะธััะตะบะปะฐ (ะฟัะพัะปะพ 90 ะดะฝะตะน)

**ะัะตะดััะปะพะฒะธั:**
- ะะฐะฟะธัั ัะพะทะดะฐะฝะฐ 91 ะดะตะฝั ะฝะฐะทะฐะด
- `available_until < now`

**ะจะฐะณะธ:**
1. ะฃัะตะฝะธะบ ะฟััะฐะตััั ะพัะบัััั ััะฐััั ะทะฐะฟะธัั

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ๏ธ ะะฐะฟะธัั ะพัะพะฑัะฐะถะฐะตััั ั ะผะตัะบะพะน "โ ะััะตะบะปะฐ"
- โ๏ธ ะะฝะพะฟะบะฐ "ะะพัะฟัะพะธะทะฒะตััะธ" ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะฐ
- โ ะฃัะธัะตะปั ะผะพะถะตั ะฟัะพะดะปะธัั ััะพะบ (ะฐะดะผะธะฝ ััะฝะบัะธั)

#### ะขะตัั 5.5: ะฃะดะฐะปะตะฝะธะต ะทะฐะฟะธัะธ ััะธัะตะปะตะผ

**ะจะฐะณะธ:**
1. ะฃัะธัะตะปั ะพัะบััะฒะฐะตั ัะฒะพะธ ะทะฐะฟะธัะธ
2. ะัะฑะธัะฐะตั ะทะฐะฟะธัั ะดะปั ัะดะฐะปะตะฝะธั
3. ะะฐะถะธะผะฐะตั "๐๏ธ ะฃะดะฐะปะธัั"
4. ะะพะดัะฒะตัะถะดะฐะตั ะดะตะนััะฒะธะต

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะะฐะฟัะพั: `DELETE /api/recordings/{id}/`
- โ ะคะฐะนะป ัะดะฐะปัะตััั ะธะท Google Drive
- โ ะะฐะฟะธัั ัะดะฐะปัะตััั ะธะท ะะ
- โ ะะฒะพัะฐ ััะธัะตะปั ัะผะตะฝััะฐะตััั ะฝะฐ ัะฐะทะผะตั ัะฐะนะปะฐ

**ะัะพะฒะตัะบะฐ:**
```sql
SELECT id FROM schedule_lessonrecording WHERE id = <recording_id>;
-- ะะพะปะถะฝะพ ะฑััั ะฟัััะพ
```

---

## ๐ง ะฃะปัััะตะฝะธั ัะธััะตะผั ะทะฐะฟะธัะธ (TODO)

### ะัะธะพัะธัะตั 1: ะัะธัะธัะตัะบะธะต ัะปัััะตะฝะธั UX

#### 1.1. ะะพะฑะฐะฒะธัั ัะตะบะฑะพะบั "๐น ะะฐะฟะธััะฒะฐัั ััะพะบ" ะฒ ัะพัะผั ัะพะทะดะฐะฝะธั ััะพะบะฐ

**ะะดะต:** `frontend/src/components/LessonForm.js` (ะธะปะธ ะฐะฝะฐะปะพะณ)

**ะะพะด:**
```javascript
<div className="form-field">
  <label>
    <input
      type="checkbox"
      checked={lesson.record_lesson}
      onChange={(e) => setLesson({
        ...lesson,
        record_lesson: e.target.checked
      })}
    />
    <span className="checkbox-label">๐น ะะฐะฟะธััะฒะฐัั ััะพะบ</span>
  </label>
  <p className="field-hint">
    Zoom ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟะธัะตั ััะพะบ ะธ ัะพััะฐะฝะธั ะฒ ัะฐะทะดะตะป "ะะฐะฟะธัะธ"
  </p>
</div>
```

**ะกัะธะปะธ:**
```css
.checkbox-label {
  font-weight: 500;
  margin-left: 8px;
}

.field-hint {
  font-size: 0.9em;
  color: #6b7280;
  margin-top: 4px;
  margin-left: 28px;
}
```

#### 1.2. ะะพะบะฐะทะฐัั ะธะฝะดะธะบะฐัะพั "๐ด ะะะะะกะฌ" ะฟัะธ ะทะฐะฟััะบะต ััะพะบะฐ

**ะะดะต:** `frontend/src/components/LessonCard.js`

**ะะพะด:**
```javascript
{lesson.record_lesson && (
  <div className="recording-indicator">
    <span className="recording-dot">โ</span>
    <span className="recording-text">ะะะะะกะฌ</span>
  </div>
)}
```

**ะกัะธะปะธ:**
```css
.recording-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  background: #fee2e2;
  border: 1px solid #ef4444;
  border-radius: 12px;
  font-size: 0.85em;
  font-weight: 600;
  color: #dc2626;
}

.recording-dot {
  font-size: 1.2em;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
```

#### 1.3. ะะปะพะบะธัะพะฒะฐัั ัะตะบะฑะพะบั ะฟะพัะปะต ะทะฐะฟััะบะฐ ััะพะบะฐ

**ะะดะต:** `frontend/src/components/LessonForm.js`

**ะะพะด:**
```javascript
<input
  type="checkbox"
  checked={lesson.record_lesson}
  onChange={(e) => setLesson({...lesson, record_lesson: e.target.checked})}
  disabled={lesson.zoom_meeting_id !== null}  // ะะฐะฑะปะพะบะธัะพะฒะฐัั ะฟะพัะปะต ััะฐััะฐ
/>
{lesson.zoom_meeting_id && (
  <p className="field-hint warning">
    โ๏ธ ะะตะปัะทั ะธะทะผะตะฝะธัั ะฟะพัะปะต ะทะฐะฟััะบะฐ ะฒัััะตัะธ
  </p>
)}
```

#### 1.4. ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ะณะพัะพะฒะฝะพััะธ ะทะฐะฟะธัะธ

**Backend:** `teaching_panel/schedule/tasks.py`

**ะะพะฑะฐะฒะธัั ะฒ ะบะพะฝะตั `process_zoom_recording()`:**
```python
# ะฃะฒะตะดะพะผะปะตะฝะธะต ััะธัะตะปั
from django.core.mail import send_mail
from django.conf import settings

teacher = recording.lesson.teacher
subject = f"ะะฐะฟะธัั ััะพะบะฐ ะณะพัะพะฒะฐ: {recording.lesson.title}"
message = f"""
ะะดัะฐะฒััะฒัะนัะต, {teacher.first_name}!

ะะฐะฟะธัั ััะพะบะฐ "{recording.lesson.title}" ะณะพัะพะฒะฐ ะบ ะฟัะพัะผะพััั.

ะะฐะทะผะตั: {recording.file_size / (1024**2):.1f} MB
ะะพัััะฟะฝะฐ ะดะพ: {recording.available_until.strftime('%d.%m.%Y')}

ะกะผะพััะตัั: {settings.FRONTEND_URL}/teacher/recordings

---
Teaching Panel LMS
"""

send_mail(
    subject,
    message,
    settings.DEFAULT_FROM_EMAIL,
    [teacher.email],
    fail_silently=True
)

logger.info(f"Sent notification to {teacher.email} about recording {recording.id}")
```

**ะขะฐะบะถะต ะดะพะฑะฐะฒะธัั Telegram ัะฒะตะดะพะผะปะตะฝะธะต:**
```python
# ะัะปะธ ั ััะธัะตะปั ะฟัะธะฒัะทะฐะฝ Telegram
if teacher.telegram_id:
    from support.telegram_utils import send_telegram_message
    
    send_telegram_message(
        teacher.telegram_id,
        f"๐น ะะฐะฟะธัั ะณะพัะพะฒะฐ!\n\n"
        f"ะฃัะพะบ: {recording.lesson.title}\n"
        f"ะะฐะทะผะตั: {recording.file_size / (1024**2):.1f} MB\n"
        f"ะกะผะพััะตัั: {settings.FRONTEND_URL}/teacher/recordings"
    )
```

### ะัะธะพัะธัะตั 2: ะกัะตะดะฝะธะต ัะปัััะตะฝะธั

#### 2.1. ะะตัะตะธะผะตะฝะพะฒะฐะฝะธะต ะทะฐะฟะธัะธ ะฟะพัะปะต ะทะฐะณััะทะบะธ

**Endpoint:** `PATCH /api/recordings/{id}/`

**Request:**
```json
{
  "title": "ะะพะฒะพะต ะฝะฐะทะฒะฐะฝะธะต ะทะฐะฟะธัะธ"
}
```

**Backend:**
```python
@api_view(['PATCH'])
@permission_classes([IsAuthenticated])
def update_recording(request, recording_id):
    try:
        recording = LessonRecording.objects.get(id=recording_id)
        
        # ะัะพะฒะตัะบะฐ ะฟัะฐะฒ (ัะพะปัะบะพ ะฒะปะฐะดะตะปะตั ััะพะบะฐ ะธะปะธ ะฐะดะผะธะฝ)
        if request.user != recording.lesson.teacher and request.user.role != 'admin':
            return Response({'error': 'Access denied'}, status=403)
        
        new_title = request.data.get('title')
        if new_title:
            recording.title = new_title
            recording.save()
            
            # ะะฟัะธะพะฝะฐะปัะฝะพ: ะฟะตัะตะธะผะตะฝะพะฒะฐัั ัะฐะนะป ะฒ Google Drive
            # gdrive_manager = get_gdrive_manager()
            # gdrive_manager.rename_file(recording.gdrive_file_id, new_title)
            
            return Response({'message': 'Title updated'}, status=200)
        
        return Response({'error': 'Title required'}, status=400)
    except LessonRecording.DoesNotExist:
        return Response({'error': 'Not found'}, status=404)
```

#### 2.2. ะะฒัะพะผะฐัะธัะตัะบะฐั ะณะตะฝะตัะฐัะธั ะฟัะตะฒัั (thumbnail)

**ะัะฟะพะปัะทัั FFmpeg:**
```python
def generate_thumbnail(video_path):
    """ะกะพะทะดะฐัั ะฟัะตะฒัั ะธะท ะฒะธะดะตะพ (ะฝะฐ 10-ะน ัะตะบัะฝะดะต)"""
    import subprocess
    
    thumbnail_path = video_path.replace('.mp4', '_thumb.jpg')
    
    cmd = [
        'ffmpeg',
        '-i', video_path,
        '-ss', '00:00:10',  # ะะฐ 10-ะน ัะตะบัะฝะดะต
        '-vframes', '1',    # 1 ะบะฐะดั
        '-vf', 'scale=320:-1',  # ะะฐัััะฐะฑ 320px
        thumbnail_path
    ]
    
    subprocess.run(cmd, check=True, capture_output=True)
    return thumbnail_path
```

**ะะฝัะตะณัะธัะพะฒะฐัั ะฒ `process_zoom_recording()`:**
```python
# ะะพัะปะต ัะบะฐัะธะฒะฐะฝะธั ั Zoom
thumbnail_path = generate_thumbnail(temp_file_path)

# ะะฐะณััะทะธัั ะฟัะตะฒัั ะฒ Google Drive
gdrive_manager = get_gdrive_manager()
thumb_file = gdrive_manager.upload_file(
    file_path=thumbnail_path,
    filename=f"thumb_{recording.id}.jpg",
    folder_id=gdrive_file['folder_id']
)

recording.thumbnail_url = thumb_file['thumbnail_link']
recording.save()

os.remove(thumbnail_path)  # ะฃะดะฐะปะธัั ะฒัะตะผะตะฝะฝัะน ัะฐะนะป
```

#### 2.3. ะััะฝะฐั ะบะฝะพะฟะบะฐ "ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั ะทะฐะฟะธัะธ"

**ะกัะตะฝะฐัะธะน:**
Webhook ะฝะต ััะฐะฑะพัะฐะป, ะฝะพ ะทะฐะฟะธัั ัะถะต ะตััั ะฝะฐ Zoom.

**Endpoint:** `POST /api/lessons/{id}/sync-recordings/`

**Backend:**
```python
@action(detail=True, methods=['post'], url_path='sync-recordings')
def sync_recordings(self, request, pk=None):
    """
    ะัััะฝัั ัะธะฝััะพะฝะธะทะธัะพะฒะฐัั ะทะฐะฟะธัะธ ั Zoom API
    ะะพะปะตะทะฝะพ ะตัะปะธ webhook ะฝะต ััะฐะฑะพัะฐะป
    """
    lesson = self.get_object()
    
    # ะัะพะฒะตัะบะฐ ะฟัะฐะฒ
    if request.user != lesson.teacher and request.user.role != 'admin':
        return Response({'error': 'Access denied'}, status=403)
    
    if not lesson.zoom_meeting_id:
        return Response({'error': 'Meeting not started yet'}, status=400)
    
    # ะะฐะฟัะพัะธัั ัะฟะธัะพะบ ะทะฐะฟะธัะตะน ั Zoom API
    from zoom_pool.zoom_service import get_meeting_recordings
    
    try:
        recordings = get_meeting_recordings(lesson.zoom_meeting_id)
        
        if not recordings:
            return Response({'message': 'No recordings found'}, status=200)
        
        # ะกะพะทะดะฐัั LessonRecording ะดะปั ะบะฐะถะดะพะณะพ ัะฐะนะปะฐ
        created_count = 0
        for rec_file in recordings:
            recording, created = LessonRecording.objects.get_or_create(
                lesson=lesson,
                zoom_recording_id=rec_file['id'],
                defaults={
                    'download_url': rec_file['download_url'],
                    'file_size': rec_file['file_size'],
                    'status': 'processing'
                }
            )
            
            if created:
                # ะะฐะฟัััะธัั ะพะฑัะฐะฑะพัะบั
                process_zoom_recording.delay(recording.id)
                created_count += 1
        
        return Response({
            'message': f'Synced {created_count} recording(s)',
            'count': created_count
        }, status=200)
    except Exception as e:
        logger.exception(f"Failed to sync recordings for lesson {lesson.id}: {e}")
        return Response({'error': str(e)}, status=500)
```

**Frontend ะบะฝะพะฟะบะฐ:**
```javascript
<button onClick={handleSyncRecordings} disabled={syncing}>
  {syncing ? '๐ ะกะธะฝััะพะฝะธะทะฐัะธั...' : '๐ ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั ะทะฐะฟะธัะธ'}
</button>
```

### ะัะธะพัะธัะตั 3: ะะธะทะบะธะต (Nice to have)

#### 3.1. ะกัะฑัะธััั (ะฐะฒัะพะผะฐัะธัะตัะบะพะต ััะฐะฝัะบัะธะฑะธัะพะฒะฐะฝะธะต)

**ะัะฟะพะปัะทัั OpenAI Whisper API:**
```python
def generate_subtitles(audio_path):
    import openai
    
    with open(audio_path, 'rb') as audio_file:
        transcript = openai.Audio.transcribe(
            model="whisper-1",
            file=audio_file,
            response_format="srt"  # SubRip format
        )
    
    return transcript
```

#### 3.2. ะะฝะฐะปะธัะธะบะฐ ะฟัะพัะผะพััะพะฒ

**Endpoint:** `POST /api/recordings/{id}/track-view/`

**ะฃะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ**, ะฝะพ ะฝัะถะฝะพ ะดะพะฑะฐะฒะธัั ะณัะฐัะธะบะธ:
- ะกะบะพะปัะบะพ ัะฐะท ะฟัะพัะผะพััะตะฝะฐ ะทะฐะฟะธัั
- ะัะพ ะธะท ััะตะฝะธะบะพะฒ ัะผะพััะตะป
- ะกัะตะดะฝัั ะดะปะธัะตะปัะฝะพััั ะฟัะพัะผะพััะฐ

#### 3.3. ะญะบัะฟะพัั ะทะฐะฟะธัะตะน ะฒ ZIP-ะฐััะธะฒ

**ะะปั ััะธัะตะปั:**
ะกะบะฐัะฐัั ะฒัะต ะทะฐะฟะธัะธ ะณััะฟะฟั ะพะดะฝะธะผ ะฐััะธะฒะพะผ.

---

## ๐ก API Reference

### POST /api/lessons/{id}/start/

**ะะฐะฟััะบ ััะพะบะฐ ั ัะพะทะดะฐะฝะธะตะผ Zoom ะฒัััะตัะธ**

**Request:** (ะฟัััะพะน body)

**Response 200:**
```json
{
  "zoom_start_url": "https://zoom.us/s/82345678901?zak=eyJ...",
  "zoom_join_url": "https://zoom.us/j/82345678901?pwd=abc123",
  "zoom_meeting_id": "82345678901",
  "zoom_password": "abc123"
}
```

**Response 403:**
```json
{
  "detail": "ะะพะดะฟะธัะบะฐ ะธััะตะบะปะฐ"
}
```

**Response 503:**
```json
{
  "error": "ะะตั ัะฒะพะฑะพะดะฝัั Zoom ะฐะบะบะฐัะฝัะพะฒ"
}
```

### POST /api/lessons/{id}/start-new/

**ะะฐะฟััะบ ั ัะตะปะธะทะพะผ ะฟัะตะดัะดััะตะน ะฒัััะตัะธ**

ะะฝะฐะปะพะณะธัะฝะพ `start/`, ะฝะพ ัะฝะฐัะฐะปะฐ ัะดะฐะปัะตั ััะฐััั ะฒัััะตัั.

### POST /schedule/api/zoom/webhook/

**Webhook ะดะปั ัะพะฑััะธะน Zoom**

**Events:**
- `endpoint.url_validation` โ ะฒะฐะปะธะดะฐัะธั URL
- `recording.completed` โ ะทะฐะฟะธัั ะณะพัะพะฒะฐ
- `recording.trashed` โ ะทะฐะฟะธัั ัะดะฐะปะตะฝะฐ
- `meeting.ended` โ ะฒัััะตัะฐ ะทะฐะฒะตััะตะฝะฐ

**Request (recording.completed):**
```json
{
  "event": "recording.completed",
  "payload": {
    "account_id": "abc123",
    "object": {
      "id": "82345678901",
      "uuid": "xyz789...",
      "topic": "ะะฐัะตะผะฐัะธะบะฐ 9ะ - ะขะตะพัะตะผะฐ ะะธัะฐะณะพัะฐ",
      "start_time": "2025-12-05T14:00:00Z",
      "recording_files": [
        {
          "id": "rec123",
          "recording_type": "shared_screen_with_speaker_view",
          "file_type": "mp4",
          "file_size": 524288000,
          "download_url": "https://zoom.us/rec/download/...",
          "play_url": "https://zoom.us/rec/play/..."
        }
      ]
    }
  }
}
```

**Response 200:**
```json
{
  "status": "success",
  "lesson_id": 42,
  "processed_files": 1
}
```

### GET /api/recordings/

**ะกะฟะธัะพะบ ะทะฐะฟะธัะตะน ะดะปั ััะตะฝะธะบะฐ**

**Response 200:**
```json
{
  "count": 5,
  "results": [
    {
      "id": 123,
      "lesson": {
        "id": 42,
        "title": "ะขะตะพัะตะผะฐ ะะธัะฐะณะพัะฐ",
        "start_time": "2025-12-05T14:00:00Z",
        "group": {
          "id": 10,
          "name": "ะะฐัะตะผะฐัะธะบะฐ 9ะ"
        }
      },
      "file_size": 524288000,
      "duration_seconds": 3600,
      "status": "ready",
      "play_url": "https://drive.google.com/file/d/...",
      "thumbnail_url": "https://drive.google.com/...",
      "available_until": "2026-03-05T14:00:00Z",
      "created_at": "2025-12-05T15:30:00Z"
    }
  ]
}
```

### GET /api/recordings/teacher/

**ะกะฟะธัะพะบ ะทะฐะฟะธัะตะน ะดะปั ััะธัะตะปั**

ะะฝะฐะปะพะณะธัะฝะพ `/api/recordings/`, ะฝะพ ะฒะพะทะฒัะฐัะฐะตั ะะกะ ะทะฐะฟะธัะธ ััะธัะตะปั.

### DELETE /api/recordings/{id}/

**ะฃะดะฐะปะตะฝะธะต ะทะฐะฟะธัะธ**

**Response 200:**
```json
{
  "message": "Recording deleted",
  "freed_space_mb": 500.5
}
```

---

## โ ะะทะฒะตััะฝัะต ะฟัะพะฑะปะตะผั

### ะัะธัะธัะตัะบะธะต

1. **โ ะงะตะบะฑะพะบั "ะะฐะฟะธััะฒะฐัั ััะพะบ" ะฝะต ะพัะพะฑัะฐะถะฐะตััั ะฒ ัะพัะผะต**
   - ะะพะปะต ัััะตััะฒัะตั ะฒ ะะ, ะฝะพ ะฝะตั UI
   - ะะตัะตะฝะธะต: ะะพะฑะฐะฒะธัั ัะตะบะฑะพะบั ะฒ LessonForm.js

2. **โ ะะตั ะธะฝะดะธะบะฐัะพัะฐ "๐ด ะะะะะกะฌ" ะฟัะธ ะทะฐะฟััะบะต ััะพะบะฐ**
   - ะฃัะธัะตะปั ะฝะต ะฒะธะดะธั, ััะพ ััะพะบ ะทะฐะฟะธััะฒะฐะตััั
   - ะะตัะตะฝะธะต: ะะพะฑะฐะฒะธัั ะฒะธะทัะฐะปัะฝัะน ะธะฝะดะธะบะฐัะพั

3. **โ Zoom Webhook ะฝะต ะฝะฐัััะพะตะฝ**
   - ะะฒัะพะผะฐัะธัะตัะบะฐั ะพะฑัะฐะฑะพัะบะฐ ะทะฐะฟะธัะตะน ะฝะต ัะฐะฑะพัะฐะตั
   - ะะตัะตะฝะธะต: ะกะปะตะดะพะฒะฐัั `ZOOM_WEBHOOK_SETUP.md`

### ะกัะตะดะฝะธะน ะฟัะธะพัะธัะตั

4. **โ๏ธ ะะตั ัะฒะตะดะพะผะปะตะฝะธะน ะพ ะณะพัะพะฒะฝะพััะธ ะทะฐะฟะธัะธ**
   - ะฃัะธัะตะปั ะฝะต ะทะฝะฐะตั, ะบะพะณะดะฐ ะทะฐะฟะธัั ะทะฐะณััะทะธะปะฐัั
   - ะะตัะตะฝะธะต: ะะพะฑะฐะฒะธัั email/Telegram ัะฒะตะดะพะผะปะตะฝะธั

5. **โ๏ธ ะะตะปัะทั ะฟะตัะตะธะผะตะฝะพะฒะฐัั ะทะฐะฟะธัั**
   - ะะฐะทะฒะฐะฝะธะต ะฑะตัะตััั ะธะท `lesson.title` ะธ ะฝะต ัะตะดะฐะบัะธััะตััั
   - ะะตัะตะฝะธะต: ะะพะฑะฐะฒะธัั endpoint `PATCH /api/recordings/{id}/`

6. **โ๏ธ ะะตั ะฟัะตะฒัั (thumbnail) ะดะปั ะทะฐะฟะธัะตะน**
   - ะกะปะพะถะฝะพ ะฒัะฑัะฐัั ะฝัะถะฝัั ะทะฐะฟะธัั
   - ะะตัะตะฝะธะต: ะะตะฝะตัะธัะพะฒะฐัั ัะตัะตะท FFmpeg

### ะะธะทะบะธะน ะฟัะธะพัะธัะตั

7. **๐ ะะตั ัััะฝะพะน ะบะฝะพะฟะบะธ "ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั ะทะฐะฟะธัะธ"**
   - ะัะปะธ webhook ะฝะต ััะฐะฑะพัะฐะป, ะฝัะถะฝะพ ะถะดะฐัั
   - ะะตัะตะฝะธะต: ะะพะฑะฐะฒะธัั endpoint `sync-recordings`

8. **๐ ะะตั ะฐะฝะฐะปะธัะธะบะธ ะฟัะพัะผะพััะพะฒ**
   - ะะต ะฒะธะดะฝะพ, ะบัะพ ัะผะพััะตะป ะทะฐะฟะธัะธ
   - ะะตัะตะฝะธะต: ะัะฐัะธะบะธ ะฒ ะฐะดะผะธะฝ-ะฟะฐะฝะตะปะธ

9. **๐ ะะตั ััะฑัะธััะพะฒ**
   - ะะตั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ััะฐะฝัะบัะธะฑะธัะพะฒะฐะฝะธั
   - ะะตัะตะฝะธะต: ะะฝัะตะณัะฐัะธั ั Whisper API

---

## โ ะงะตะบ-ะปะธัั ะดะตะฟะปะพั

### ะะตัะตะด ะดะตะฟะปะพะตะผ

- [ ] ะัะต ัะตััั ะธะท ะะฐะทะดะตะปะฐ 1-5 ะฟัะพัะปะธ ะปะพะบะฐะปัะฝะพ
- [ ] ะัะพะฒะตัะตะฝะฐ ัะฐะฑะพัะฐ ะฝะฐ staging
- [ ] ะะธะณัะฐัะธะธ ะะ ะฟะพะดะณะพัะพะฒะปะตะฝั
- [ ] Frontend ัะพะฑัะฐะฝ ะฑะตะท ะพัะธะฑะพะบ

### Backend

- [ ] ะัะธะผะตะฝะตะฝั ะผะธะณัะฐัะธะธ: `python manage.py migrate`
- [ ] ะัะพะฒะตัะตะฝะพ ะฟะพะปะต `record_lesson` ะฒ ัะฐะฑะปะธัะต `schedule_lesson`:
  ```sql
  SELECT column_name, data_type FROM information_schema.columns 
  WHERE table_name = 'schedule_lesson' AND column_name = 'record_lesson';
  ```
- [ ] ะะฐัััะพะตะฝ Zoom Webhook (ัะผ. `ZOOM_WEBHOOK_SETUP.md`)
- [ ] Webhook Secret Token ะฒ `settings.py`:
  ```python
  ZOOM_WEBHOOK_SECRET_TOKEN = 'YOUR_SECRET_HERE'
  ```
- [ ] Celery worker ะทะฐะฟััะตะฝ:
  ```bash
  sudo systemctl status celery-worker
  ```
- [ ] Celery beat ะทะฐะฟััะตะฝ (ะดะปั ะฟะตัะธะพะดะธัะตัะบะธั ะทะฐะดะฐั):
  ```bash
  sudo systemctl status celery-beat
  ```
- [ ] Google Drive ะธะฝัะตะณัะฐัะธั ะฝะฐัััะพะตะฝะฐ (ัะผ. `GDRIVE_SETUP_GUIDE.md`)

### Frontend

- [ ] ะะพะฑะฐะฒะปะตะฝ ัะตะบะฑะพะบั "ะะฐะฟะธััะฒะฐัั ััะพะบ" ะฒ ัะพัะผั ัะพะทะดะฐะฝะธั ััะพะบะฐ
- [ ] ะะพะฑะฐะฒะปะตะฝ ะธะฝะดะธะบะฐัะพั "๐ด ะะะะะกะฌ" ะฟัะธ ะทะฐะฟััะบะต ััะพะบะฐ
- [ ] ะัะพะฒะตัะตะฝะพ ะพัะพะฑัะฐะถะตะฝะธะต ะทะฐะฟะธัะตะน ะฒ ัะฐะทะดะตะปะต `/teacher/recordings` ะธ `/student/recordings`
- [ ] Prod build ัะพะฑัะฐะฝ: `npm run build`

### ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ production

- [ ] ะกะพะทะดะฐัั ััะพะบ ั ัะตะบะฑะพะบัะพะผ "ะะฐะฟะธััะฒะฐัั ััะพะบ"
- [ ] ะะฐะฟัััะธัั ััะพะบ ะธ ะฟัะพะฒะตัะธัั ะธะฝะดะธะบะฐัะพั ะทะฐะฟะธัะธ
- [ ] ะัะพะฒะตััะธ ะบะพัะพัะบัั ะฒัััะตัั (1-2 ะผะธะฝััั)
- [ ] ะะฐะฒะตััะธัั ะฒัััะตัั
- [ ] ะะพะดะพะถะดะฐัั 10-15 ะผะธะฝัั
- [ ] ะัะพะฒะตัะธัั, ััะพ ะทะฐะฟะธัั ะฟะพัะฒะธะปะฐัั ะฒ ัะฐะทะดะตะปะต "ะะฐะฟะธัะธ"
- [ ] ะัะพะฒะตัะธัั, ััะพ ัะฐะนะป ะทะฐะณััะถะตะฝ ะฒ Google Drive
- [ ] ะัะพะฒะตัะธัั, ััะพ ะบะฒะพัะฐ ััะธัะตะปั ะพะฑะฝะพะฒะธะปะฐัั

### ะะพะฝะธัะพัะธะฝะณ

- [ ] ะัะพะฒะตัะธัั ะปะพะณะธ Django:
  ```bash
  sudo tail -f /var/log/teaching_panel/django.log | grep -E "recording|webhook"
  ```
- [ ] ะัะพะฒะตัะธัั ะปะพะณะธ Celery:
  ```bash
  sudo tail -f /var/log/teaching_panel/celery.log
  ```
- [ ] ะัะพะฒะตัะธัั webhook endpoint ะดะพัััะฟะตะฝ:
  ```bash
  curl -X POST https://72.56.81.163/schedule/api/zoom/webhook/ \
    -H "Content-Type: application/json" \
    -d '{"event":"endpoint.url_validation","payload":{"plainToken":"test"}}'
  ```

---

## ๐ ะะตััะธะบะธ ััะฟะตัะฐ

| ะะตััะธะบะฐ | ะฆะตะปะตะฒะพะต ะทะฝะฐัะตะฝะธะต | ะะฐะบ ะธะทะผะตัะธัั |
|---------|------------------|--------------|
| ะฃัะฟะตัะฝะพััั ะทะฐะฟััะบะฐ ััะพะบะฐ | >99% | Analytics, ะปะพะณะธ |
| ะัะตะผั ัะพะทะดะฐะฝะธั Zoom ะฒัััะตัะธ | <2 ัะตะบ | Network tab |
| ะฃัะฟะตัะฝะพััั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟะธัะตะน | >95% | DB query, Celery logs |
| ะัะตะผั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟะธัะธ | <15 ะผะธะฝ (ะดะปั 500 MB) | Celery logs |
| ะะพัััะฟะฝะพััั ะทะฐะฟะธัะตะน | >99% | Google Drive uptime |
| ะัะพัะตะฝั ะทะฐะฟะธัะตะน ั ะพัะธะฑะบะฐะผะธ | <5% | DB query: `status='failed'` |

---

## ๐ ะะปะฐะฝ ะพะฑะฝะพะฒะปะตะฝะธะน

### ะัะฐัะบะพััะพัะฝัะต (1-2 ะฝะตะดะตะปะธ)

1. โ ะะพะฑะฐะฒะธัั ัะตะบะฑะพะบั "ะะฐะฟะธััะฒะฐัั ััะพะบ" ะฒ ัะพัะผั
2. โ ะะพะฑะฐะฒะธัั ะธะฝะดะธะบะฐัะพั "๐ด ะะะะะกะฌ"
3. โ ะะฐัััะพะธัั Zoom Webhook
4. โ ะะพะฑะฐะฒะธัั email/Telegram ัะฒะตะดะพะผะปะตะฝะธั ะพ ะณะพัะพะฒะฝะพััะธ ะทะฐะฟะธัะธ

### ะกัะตะดะฝะตััะพัะฝัะต (1 ะผะตััั)

1. ะะตัะตะธะผะตะฝะพะฒะฐะฝะธะต ะทะฐะฟะธัะตะน
2. ะะตะฝะตัะฐัะธั ะฟัะตะฒัั (thumbnail)
3. ะััะฝะฐั ะบะฝะพะฟะบะฐ "ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั ะทะฐะฟะธัะธ"
4. ะะฝะฐะปะธัะธะบะฐ ะฟัะพัะผะพััะพะฒ

### ะะพะปะณะพััะพัะฝัะต (2-3 ะผะตัััะฐ)

1. ะกัะฑัะธััั (Whisper API)
2. ะญะบัะฟะพัั ะทะฐะฟะธัะตะน ะฒ ZIP
3. ะะฝัะตะณัะฐัะธั ั YouTube (ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะฑะปะธะบะฐัะธั)
4. Live streaming (ััะฐะฝัะปััะธั ััะพะบะฐ ะฝะฐ YouTube/Twitch)

---

**ะะพะบัะผะตะฝั ัะพะทะดะฐะฝ:** 2 ะดะตะบะฐะฑัั 2025  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 2 ะดะตะบะฐะฑัั 2025  
**ะะฒัะพั:** GitHub Copilot + ะบะพะผะฐะฝะดะฐ Teaching Panel  
**ะกัะฐััั:** โ ะะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

---

## ๐ก ะัะฒะตั ะฝะฐ ะฒะพะฟัะพั: "ะะพะถะฝะพ ะปะธ ัะฐะบ ัะดะตะปะฐัั?"

**ะะฐ, ัะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะทะฐะฟะธัะธ ะฃะะ ะะะะะะะะะะะ!** ๐

ะงัะพ ัะถะต ัะฐะฑะพัะฐะตั:
- โ ะะพะปะต `record_lesson` ะฒ ะะ
- โ Zoom ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟะธััะฒะฐะตั ะฒัััะตัะธ
- โ Webhook ะพะฑัะฐะฑะพััะธะบ ะฟะพะปััะฐะตั ัะพะฑััะธะต `recording.completed`
- โ Celery ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะบะฐัะธะฒะฐะตั ะทะฐะฟะธัั ั Zoom
- โ ะะฐะฟะธัั ะทะฐะณััะถะฐะตััั ะฒ Google Drive
- โ ะัะพะฑัะฐะถะฐะตััั ะฒ ัะฐะทะดะตะปะต "๐น ะะฐะฟะธัะธ" ั ะฝะฐะทะฒะฐะฝะธะตะผ ััะพะบะฐ

**ะงัะพ ะฝัะถะฝะพ ะดะพัะฐะฑะพัะฐัั:**
1. ะะพะฑะฐะฒะธัั ัะตะบะฑะพะบั ะฒ ัะพัะผั ัะพะทะดะฐะฝะธั ััะพะบะฐ (UI)
2. ะะพะบะฐะทะฐัั ะธะฝะดะธะบะฐัะพั "๐ด ะะะะะกะฌ" ะฟัะธ ะทะฐะฟััะบะต
3. ะะฐัััะพะธัั Zoom Webhook (5 ะผะธะฝัั, ะธะฝััััะบัะธั ะณะพัะพะฒะฐ)
4. ะะพะฑะฐะฒะธัั ัะฒะตะดะพะผะปะตะฝะธั ะพ ะณะพัะพะฒะฝะพััะธ ะทะฐะฟะธัะธ

**ะัะต API ะธ backend ะณะพัะพะฒั, ะฝัะถะฝะพ ัะพะปัะบะพ ัะปัััะธัั UX!**
