# üì¶ –ú–∏–≥—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ Google Drive

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–°–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
- **RAM**: 2GB (–∫—Ä–∏—Ç–∏—á–Ω–æ –º–∞–ª–æ –¥–ª—è —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
- **Disk**: ~20GB —Å–≤–æ–±–æ–¥–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º—ã**: Out of Memory –ø—Ä–∏ npm build

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ Google Drive (2TB –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

---

## –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ Google Drive?

1. ‚úÖ **–ó–∞–ø–∏—Å–∏ —É—Ä–æ–∫–æ–≤** (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. üÜï **–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è** (—Ñ–∞–π–ª—ã —É—á–µ–Ω–∏–∫–æ–≤) - NEW
3. üÜï **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —É—Ä–æ–∫–æ–≤** (PDF, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏) - NEW
4. üÜï **–í–ª–æ–∂–µ–Ω–∏—è** (attachments) - NEW

**–õ–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ:
- –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS/JS)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

---

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫

### 1.1 –û—Ç–∫—Ä–æ–π—Ç–µ Google Drive

üëâ https://drive.google.com

### 1.2 –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫–∏

```
üìÅ TeachingPanel/
‚îú‚îÄ‚îÄ üìÅ Recordings/          ‚Üê –£–∂–µ —Å–æ–∑–¥–∞–Ω–∞
‚îú‚îÄ‚îÄ üìÅ Homework/            ‚Üê NEW: –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
‚îú‚îÄ‚îÄ üìÅ Materials/           ‚Üê NEW: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —É—Ä–æ–∫–æ–≤  
‚îî‚îÄ‚îÄ üìÅ Attachments/         ‚Üê NEW: –í–ª–æ–∂–µ–Ω–∏—è
```

### 1.3 –ü–æ–ª—É—á–∏—Ç–µ ID –ø–∞–ø–æ–∫

–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–∏:
1. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí "–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É"
2. –°—Å—ã–ª–∫–∞ –≤–∏–¥–∞: `https://drive.google.com/drive/folders/1ABC...XYZ`
3. ID –ø–∞–ø–∫–∏ = `1ABC...XYZ` (—á–∞—Å—Ç—å –ø–æ—Å–ª–µ `/folders/`)

**–ó–∞–ø–∏—à–∏—Ç–µ ID –≤—Å–µ—Ö –ø–∞–ø–æ–∫!**

---

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 2.1 –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@72.56.81.163
```

### 2.2 –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cd /var/www/teaching_panel

# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω–µ—Ç)
nano .env
```

–î–æ–±–∞–≤—å—Ç–µ:

```bash
# Google Drive Storage
USE_GDRIVE_STORAGE=1
GDRIVE_ROOT_FOLDER_ID=<ID –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ TeachingPanel>
GDRIVE_HOMEWORK_FOLDER_ID=<ID –ø–∞–ø–∫–∏ Homework>
GDRIVE_MATERIALS_FOLDER_ID=<ID –ø–∞–ø–∫–∏ Materials>
GDRIVE_ATTACHMENTS_FOLDER_ID=<ID –ø–∞–ø–∫–∏ Attachments>
```

**–ó–∞–º–µ–Ω–∏—Ç–µ** `<ID ...>` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∏–∑ —à–∞–≥–∞ 1.3!

### 2.3 –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

```bash
systemctl restart teaching_panel
```

---

## –®–∞–≥ 3: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

### 3.1 –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é

```bash
cd /var/www/teaching_panel
tar -czf media_backup_$(date +%Y%m%d).tar.gz media/
```

### 3.2 –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

```bash
cd teaching_panel
python manage.py migrate_to_gdrive --dry-run
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥. –ï—Å–ª–∏ –≤—Å—ë –æ–∫:

```bash
python manage.py migrate_to_gdrive --execute
```

### 3.3 –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –°–∫–æ–ª—å–∫–æ –º–µ—Å—Ç–∞ –æ—Å–≤–æ–±–æ–¥–∏–ª–æ—Å—å
du -sh media/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Google Drive
python manage.py test_gdrive_storage
```

---

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–µ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è `USE_GDRIVE_STORAGE=1` –≤—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –Ω–∞ Google Drive:

### –ú–æ–¥–µ–ª–∏ —Å FileField:

```python
# homework/models.py
class HomeworkSubmission(models.Model):
    file = models.FileField(
        upload_to='homework_submissions/',
        storage=homework_storage,  # ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Google Drive
        blank=True, 
        null=True
    )
```

### API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

```json
{
  "id": 123,
  "file": "https://drive.google.com/file/d/1ABC...XYZ/view",
  "file_download_url": "https://drive.google.com/uc?export=download&id=1ABC...XYZ"
}
```

---

## –®–∞–≥ 5: –û—á–∏—Å—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
cd /var/www/teaching_panel

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (–æ—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é!)
rm -rf media/homework_submissions/*
rm -rf media/lesson_materials/*

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Å–≤–æ–±–æ–¥–∏–≤—à–µ–µ—Å—è –º–µ—Å—Ç–æ
df -h
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç—ã Google Drive

```bash
python manage.py check_gdrive_quota
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
python manage.py test_gdrive_upload
```

### –õ–æ–≥–∏

```bash
tail -f /var/log/teaching_panel/app.log | grep -i gdrive
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞**: +10GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞  
‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: CDN Google Drive  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –§–∞–π–ª—ã –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: 2TB –≤–º–µ—Å—Ç–æ 20GB  
‚úÖ **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤ Google Drive  

---

## –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –û—Ç–∫–ª—é—á–∏—Ç—å Google Drive Storage:

```bash
# –í .env
USE_GDRIVE_STORAGE=0

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart teaching_panel
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:

```bash
cd /var/www/teaching_panel
tar -xzf media_backup_YYYYMMDD.tar.gz
```

---

## FAQ

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ—á—ë—Ç?**  
A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ refresh_token.

**Q: –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã?**  
A: Google Drive API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç resumable upload (–¥–æ 100MB/s).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ?**  
A: –î–∞, –∑–∞–ø–∏—Å–∏ —É—Ä–æ–∫–æ–≤ —É–∂–µ —Ç–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è.

**Q: –ë–µ–∑–æ–ø–∞—Å–Ω—ã –ª–∏ —Ñ–∞–π–ª—ã?**  
A: –î–∞, –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Service Account —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏.

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é  
**–í—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏**: ~10-30 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä—ë–º–∞ —Ñ–∞–π–ª–æ–≤)
