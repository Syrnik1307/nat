# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ Telegram/WhatsApp

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞:
- üì± **Telegram** - —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- üí¨ **WhatsApp** - —á–µ—Ä–µ–∑ Twilio API

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å
- –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞
- –í–≤–æ–¥–∏—Ç —Å–≤–æ–π email –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- –í—ã–±–∏—Ä–∞–µ—Ç –º–µ—Ç–æ–¥: Telegram –∏–ª–∏ WhatsApp

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞
- –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫—ç—à–µ –Ω–∞ 15 –º–∏–Ω—É—Ç
- –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä

### 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–æ–¥
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è (–¥–µ–π—Å—Ç–≤—É–µ—Ç 30 –º–∏–Ω—É—Ç)

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
- –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### Telegram Bot

1. **–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather**
   ```
   /newbot
   –ò–º—è –±–æ—Ç–∞: YourBot
   Username: your_bot
   ```

2. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ .env**
   ```env
   TELEGRAM_BOT_TOKEN=your_bot_token_here
   ```

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞–ø–∏—Å–∞—Ç—å /start –±–æ—Ç—É**
   
   –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –±–æ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∏—Ö chat_id –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

### WhatsApp (Twilio)

1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ Twilio**: https://www.twilio.com/

2. **–ü–æ–ª—É—á–∏—Ç–µ WhatsApp Sandbox** –∏–ª–∏ –∫—É–ø–∏—Ç–µ –Ω–æ–º–µ—Ä WhatsApp Business

3. **–î–æ–±–∞–≤—å—Ç–µ credentials –≤ .env**
   ```env
   TWILIO_ACCOUNT_SID=your_account_sid
   TWILIO_AUTH_TOKEN=your_auth_token
   TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886
   ```

4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É**
   ```bash
   pip install twilio
   ```

## API Endpoints

### 1. –ó–∞–ø—Ä–æ—Å –∫–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```http
POST /accounts/api/password-reset/request-code/
Content-Type: application/json

{
  "email": "user@example.com",
  "phone": "+79991234567",
  "method": "telegram"  // –∏–ª–∏ "whatsapp"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "method": "telegram",
  "message": "–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ telegram",
  "code": "123456"  // —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
}
```

**–û—Ç–≤–µ—Ç (–æ—à–∏–±–∫–∞):**
```json
{
  "success": false,
  "error": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
```http
POST /accounts/api/password-reset/verify-code/
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "token": "abc123def456...",
  "message": "–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω. –ú–æ–∂–µ—Ç–µ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å."
}
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
```http
POST /accounts/api/password-reset/set-password/
Content-Type: application/json

{
  "token": "abc123def456...",
  "new_password": "NewPassword123"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "message": "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω"
}
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é

- –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
- –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞
- –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞
- –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ 6-–∑–Ω–∞—á–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–¥
- ‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 15 –º–∏–Ω—É—Ç
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫—ç—à–µ (Redis/Memcached)
- ‚úÖ –£–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ

### –¢–æ–∫–µ–Ω —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
- ‚úÖ 64-—Å–∏–º–≤–æ–ª—å–Ω–∞—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
- ‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –º–∏–Ω—É—Ç
- ‚úÖ –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π (–ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º)
- ‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ü—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ Email –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –ë–î
- ‚úÖ Rate limiting (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

## Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### PasswordResetModal
–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å 4 —à–∞–≥–∞–º–∏:
1. –í–≤–æ–¥ email –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ (Telegram/WhatsApp)
3. –í–≤–æ–¥ –∫–æ–¥–∞
4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```jsx
import PasswordResetModal from './components/PasswordResetModal';

<PasswordResetModal
  isOpen={showResetModal}
  onClose={() => setShowResetModal(false)}
/>
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å CustomUser:

```python
telegram_chat_id = models.CharField(
    _('Telegram Chat ID'),
    max_length=50,
    blank=True,
    null=True,
    help_text=_('Chat ID –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞')
)
```

**–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**
```bash
cd teaching_panel
python manage.py migrate accounts
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ë–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ API –æ—Ç–≤–µ—Ç–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!):
```json
{
  "success": true,
  "code": "123456"
}
```

‚ö†Ô∏è **–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —É–±—Ä–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É –∏–∑ `password_reset_sender.py`:**
```python
result['code'] = code  # –£–î–ê–õ–ò–¢–¨ –í –ü–†–û–î–ê–ö–®–ï–ù–ï!
```

### 2. –° —Ä–µ–∞–ª—å–Ω—ã–º Telegram –±–æ—Ç–æ–º

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç `/start` –≤–∞—à–µ–º—É –±–æ—Ç—É
2. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç chat_id –≤ –ë–î
3. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∫–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### 3. –° WhatsApp (Twilio)

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Twilio Sandbox
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Sandbox
3. –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∫–æ–¥—ã —á–µ—Ä–µ–∑ WhatsApp

## Troubleshooting

### –û—à–∏–±–∫–∞: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–≤—è–∑–∞–ª –∞–∫–∫–∞—É–Ω—Ç —Å Telegram –±–æ—Ç–æ–º"
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –Ω–∞–ø–∏—Å–∞—Ç—å `/start` –≤–∞—à–µ–º—É –±–æ—Ç—É.

### –û—à–∏–±–∫–∞: "WhatsApp (Twilio) –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ credentials Twilio –≤ `.env` —Ñ–∞–π–ª.

### –û—à–∏–±–∫–∞: "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–æ—Ç –∂–µ –Ω–æ–º–µ—Ä, —á—Ç–æ —É–∫–∞–∑–∞–Ω –≤ –ø—Ä–æ—Ñ–∏–ª–µ.

### –ö–æ–¥ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
2. –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å telegram_chat_id –≤ –ë–î
3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials –≤ .env
4. –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏

## –£–ª—É—á—à–µ–Ω–∏—è (TODO)

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ chat_id –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ deep link
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ (Viber, Line –∏ —Ç.–¥.)
- [ ] –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ email –æ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è
- [ ] Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –∫–æ–¥–æ–≤
- [ ] –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
teaching_panel/
‚îú‚îÄ‚îÄ accounts/
‚îÇ   ‚îú‚îÄ‚îÄ models.py                    # CustomUser —Å telegram_chat_id
‚îÇ   ‚îú‚îÄ‚îÄ password_reset_sender.py     # –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ password_reset_views.py      # API endpoints
‚îÇ   ‚îî‚îÄ‚îÄ urls.py                      # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ
frontend/
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ components/
        ‚îú‚îÄ‚îÄ PasswordResetModal.js    # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
        ‚îú‚îÄ‚îÄ PasswordResetModal.css   # –°—Ç–∏–ª–∏
        ‚îî‚îÄ‚îÄ AuthPage.js              # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```
