# Система поддержки v2 - Руководство по работе

## Обзор

Система поддержки позволяет:
- Получать обращения пользователей через форму в приложении и Telegram
- Управлять тикетами с приоритетами P0-P3 и SLA
- Объявлять и завершать инциденты
- Мониторить статус системы

## Приоритеты и SLA

| Приоритет | Описание | SLA (первый ответ) |
|-----------|----------|-------------------|
| **P0** | Инцидент - всем плохо (массовый сбой) | 15 минут |
| **P1** | Критично - блокирует работу конкретного пользователя | 2 часа |
| **P2** | Важно - есть обходной путь | 8 часов (1 рабочий день) |
| **P3** | Низкий - вопрос, пожелание, консультация | 24 часа |

## Категории проблем

- `login` - Вход/Регистрация
- `payment` - Оплата/Подписка
- `lesson` - Уроки/Расписание
- `zoom` - Zoom/Видеосвязь
- `homework` - Домашние задания
- `recording` - Записи уроков
- `other` - Другое

## Telegram-бот команды

### Базовые
| Команда | Описание |
|---------|----------|
| `/start` | Регистрация/проверка доступа |
| `/tickets` | Список открытых тикетов (топ-10) |
| `/my` | Мои назначенные тикеты |
| `/view_<id>` | Просмотр конкретного тикета |
| `/reply <id> <сообщение>` | Ответить на тикет |
| `/stats` | Статистика поддержки |

### Инцидент-режим
| Команда | Описание |
|---------|----------|
| `/incident <название>` | Объявить инцидент (P0) |
| `/resolve <сообщение>` | Завершить инцидент |
| `/status` | Проверить статус системы |
| `/sla` | Показать тикеты с нарушением SLA |

### Примеры

```
/incident Проблемы с оплатой - не проходят платежи
/resolve Проблема решена, платежи работают
/reply 42 Спасибо за обращение! Уже разбираемся.
```

## API Endpoints

### Публичные
- `GET /api/support/status/` - Статус системы
- `GET /api/support/health/` - Health check для мониторинга

### Для пользователей
- `POST /api/support/tickets/` - Создать тикет
- `GET /api/support/tickets/` - Мои тикеты
- `GET /api/support/tickets/<id>/` - Детали тикета
- `POST /api/support/tickets/<id>/add_message/` - Добавить сообщение

### Для администраторов
- `GET /api/support/stats/` - Статистика поддержки
- `GET /api/support/categories/` - Список категорий
- `GET /api/support/priorities/` - Список приоритетов с SLA

## Рекомендуемый workflow

### Каждое утро (10:00)
1. `/sla` - проверить просроченные тикеты
2. `/tickets` - посмотреть новые
3. Ответить на срочные (P0-P1)

### При массовом сбое
1. `/incident <описание>` - включить режим инцидента
2. Все пользователи видят баннер
3. Фокус на починке
4. `/resolve <сообщение>` - когда починили

## Деплой

```bash
# Применить миграцию
python manage.py migrate support

# Перезапустить бота поддержки
sudo systemctl restart support_bot

# Проверить
curl https://yoursite.com/api/support/health/
```

## Переменные окружения

```bash
SUPPORT_BOT_TOKEN=<token_from_botfather>
TELEGRAM_BOT_TOKEN=<main_bot_token>
TELEGRAM_BOT_USERNAME=teaching_panel_bot
```
